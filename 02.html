<!DOCTYPE html>
<html lang="ug" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù‰Ù„Ù‰Ùƒ ØªÛ•ØªÙ‚Ù‰Ù‚Ø§Øª Ù…Û•Ø±ÙƒÙ‰Ø²Ù‰ - Ù…Ø§Ù‚Ø§Ù„Û• Ø¦Ø§Ù†Ø§Ù„Ù‰Ø² Ù‚Û‡Ø±Ø§Ù„Ù‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @font-face { font-family: 'UKIJ Ekran'; src: local('UKIJ Ekran'), local('UKIJ_Ekran'); }
        @font-face { font-family: 'UKIJ Tuz'; src: local('UKIJ Tuz'), local('UKIJ_Tuz'); }
        body { font-family: "UKIJ Ekran", "ALKATIP Tor", "Noto Naskh Arabic", sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        textarea { resize: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-slate-900 text-white shadow-lg border-b-4 border-sky-600">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="bg-sky-600 w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl">B</div>
            <div>
                <h1 class="text-xl md:text-2xl font-bold tracking-wide">Ø¨Ù‰Ù„Ù‰Ùƒ ØªÛ•ØªÙ‚Ù‰Ù‚Ø§Øª Ù…Û•Ø±ÙƒÙ‰Ø²Ù‰</h1>
                <p class="text-slate-400 text-xs">Ù…Ø§Ù‚Ø§Ù„Û• Ø¦Ø§Ù†Ø§Ù„Ù‰Ø² Ø³Ù‰Ø³ØªÛÙ…Ù‰Ø³Ù‰ v6.4 (Compact Pro)</p>
            </div>
        </div>
    </div>
</nav>

<div class="flex-grow container mx-auto p-4 flex flex-col lg:flex-row gap-6 h-[calc(100vh-100px)]">

    <!-- Left Sidebar -->
    <div class="w-full lg:w-1/3 flex flex-col gap-4 overflow-y-auto pr-1">
        <!-- Step 1 -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
            <div class="bg-sky-50 p-4 border-b border-sky-100 flex justify-between items-center">
                <h2 class="font-bold text-sky-800 flex items-center gap-2">
                    <span class="bg-sky-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm">1</span>
                    AI Ø¦ÛˆÚ†ÛˆÙ† Ø¨Û‡ÙŠØ±Û‡Ù‚ (Prompt)
                </h2>
            </div>
            <div class="p-4">
                <div class="relative group">
                        <textarea id="aiPrompt" readonly class="w-full h-32 p-3 text-xs font-mono bg-slate-50 border border-gray-300 rounded text-gray-600 focus:outline-none" dir="ltr">
Ù…Û•Ù† Ø³Ø§Ú­Ø§ Ø¨Ù‰Ø± Ù†Û•Ú†Ú†Û• Ù…Ø§Ù‚Ø§Ù„Û•ØŒ Ø®Û•Û‹Û•Ø± ÙŠØ§ÙƒÙ‰ Ø¦Ø§Ù†Ø§Ù„Ù‰Ø²Ù„Ø§Ø±Ù†Ù‰ Ø¨ÛØ±Ù‰Ù…Û•Ù†. Ø³Û•Ù† Â«Ø¨Ù‰Ù„Ù‰Ùƒ ØªÛ•ØªÙ‚Ù‰Ù‚Ø§Øª Ù…Û•Ø±ÙƒÙ‰Ø²Ù‰Â» Ù†Ù‰Ú­ Ø¨Ø§Ø´ Ø¦Ø§Ù†Ø§Ù„Ù‰Ø²Ú†Ù‰Ø³Ù‰ Ø³Ø§Ù„Ø§Ú¾Ù‰ÙŠÙ‰ØªÙ‰Ø¯Û• ØªÛ†Û‹Û•Ù†Ø¯Ù‰ÙƒÙ‰ ØªÛ•Ù„Û•Ù¾Ù„Û•Ø± Ø¨ÙˆÙŠÙ‰Ú†Û• Ú†ÙˆÚ­Ù‚Û‡Ø± Û‹Û• ÙƒÛ•Ø³Ù¾Ù‰ÙŠ Ø¦Ø§Ù†Ø§Ù„Ù‰Ø² Ù‚Ù‰Ù„Ù‰Ù¾ØŒ Ù†Û•ØªÙ‰Ø¬Ù‰Ù†Ù‰ Ù¾Û•Ù‚Û•ØªÙ„Ø§ JSON ÙÙˆØ±Ù…Ø§ØªÙ‰Ø¯Ø§ Ù‚Ø§ÙŠØªÛ‡Ø±Û‡Ù¾ Ø¨Û•Ø±.

### ØªÛ•Ù„Û•Ù¾Ù„Û•Ø± (ØªÛ•Ù¾Ø³Ù‰Ù„Ù‰ÙŠ Ø¦ÙˆÙ‚Û‡Ù¾ Ú†Ù‰Ù‚):
1. **Ú†ÙˆÚ­ Ø®Û‡Ù„Ø§Ø³Û•:** Ø¨Ø§Ø±Ù„Ù‰Ù‚ Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ù†Ù‰Ú­ Ù…Û•Ø²Ù…Û‡Ù†Ù‰Ø¯Ù‰Ù† Ø¨Ù‰Ø± Ú†ÙˆÚ­ Û‹Û• Ø¦Û‡Ø²Û‡Ù† Ø¦Ø§Ø¨Ø²Ø§Ø³Ù„Ù‰Ù‚ Ø®Û‡Ù„Ø§Ø³Û• (Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û•ØŒ Ø¦ÛÙ†Ú¯Ù„Ù‰Ø²Ú†Û•ØŒ Ø¦Û•Ø±Û•Ø¨Ú†Û•). Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Ù‰Ø³Ù‰ Ø¦Û•Ú­ ØªÛ•Ù¾Ø³Ù‰Ù„Ù‰ÙŠ Ø¨ÙˆÙ„Ø³Û‡Ù†.
2. **Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø± Ø®Û‡Ù„Ø§Ø³Ù‰Ø³Ù‰:** Ú¾Û•Ø± Ø¨Ù‰Ø± Ù…Ø§Ù‚Ø§Ù„Ù‰Ù†Ù‰Ú­ Ø¦Ù‰Ø³Ù…Ù‰Ù†Ù‰Ú­ Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• ØªÛ•Ø±Ø¬Ù‰Ù…Ù‰Ø³Ù‰ØŒ Ù…Û•Ù†Ø¨Û•Ø³Ù‰ (Û‹Û• Ù…Û•Ù†Ø¨Û• Ø¦Ø§Ø¯Ø±ÛØ³Ù‰)ØŒ Û‹Ø§Ù‚ØªÙ‰ØŒ Ø¦Ø§Ù¾ØªÙˆØ±Ù‰ØŒ 5 Ø¦Ø§Ø¨Ø²Ø§Ø³Ù„Ù‰Ù‚ Ø¦Ø§Ø³Ø§Ø³Ù„Ù‰Ù‚ Ù…Û•Ø²Ù…Û‡Ù†Ù‰.
3. **Ø³Ø§Ù†-Ø³Ù‰ÙÙ‰Ø±Ù„Ø§Ø±:** Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ø¯Ù‰ÙƒÙ‰ Ø¨Ø§Ø±Ù„Ù‰Ù‚ Ù…Û‡Ú¾Ù‰Ù… Ø³Ù‰ØªØ§ØªÙ‰Ø³ØªÙ‰ÙƒÙ‰Ù„Ø§Ø±Ù†Ù‰Ú­ Ú¾Û•Ù…Ù…Ù‰Ø³Ù‰Ù†Ù‰ Û‹Û• Ø¦Û‡Ù„Ø§Ø±Ù†Ù‰Ú­ Ù…Û•Ù†Ø¨Û•Ø³Ù‰.
4. **Ù†Û•Ù‚Ù‰Ù„Ù„Û•Ø±:** Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ø¯Û• ØªÙ‰Ù„ØºØ§ Ø¦ÛÙ„Ù‰Ù†ØºØ§Ù† Ù…Û‡Ú¾Ù‰Ù… Ø´Û•Ø®Ø³Ù„Û•Ø±Ù†Ù‰Ú­ Ø³Û†Ø²Ù„Ù‰Ø±Ù‰Ù†Ù‰Ú­ Ú¾Û•Ù…Ù…Ù‰Ø³Ù‰Ù†Ù‰ Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• ØªÛ•Ø±Ø¬Ù‰Ù…Ù‰Ø³Ù‰ (Ø³Û†Ø²Ù„Ù‰Ú¯ÛˆÚ†Ù‰ Û‹Û• Ø¦Û•Ø³Ù„Ù‰ Ù…Û•Ù†Ø¨Û•Ø³Ù‰ Ø¨Ù‰Ù„Û•Ù†). Ø¦Û•Ú¯Û•Ø± Ù…Ø§Ù‚Ø§Ù„Ù‰Ø¯Ø§ Ø¨Û‡Ù†Ø¯Ø§Ù‚ Ù†Û•Ù‚Ù‰Ù„ Ø¨ÙˆÙ„Ù…Ù‰Ø³Ø§ØŒ Ù…Û‡Ú¾Ù‰Ù… Ú¾Û•Ø¯Ù‰Ø³Ù„Û•Ø±Ù†Ù‰Ú­ Ø¦Û•Ø±Û•Ø¨Ú†Û• Û‹Û• Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Ù‰Ø³Ù‰Ù†Ù‰ Ù…Û•Ù†Ø¨Û• Ø¨Ù‰Ù„Û•Ù† Ù‚ÙˆØ´Û‡Ù¾ Ù‚ÙˆÙŠØ³Ø§Ú­ Ø¨ÙˆÙ„Ù‰Ø¯Û‡.
5. **Ø´Û•Ø±Ù‚Ù‰ÙŠ ØªÛˆØ±ÙƒÙ‰Ø³ØªØ§Ù† Ø¦ÛˆÚ†ÛˆÙ†:** Ù…Û‡Ø³ØªÛ•Ù‚Ù‰Ù„Ù„Ù‰Ù‚ Ú¾Û•Ø±Ù‰ÙƒÙ‰ØªÙ‰Ù…Ù‰Ø² Ø¦ÛˆÚ†ÛˆÙ† Ø¦Û•Ú­ Ù…Û‡Ú¾Ù‰Ù… 3 Ù…Ø§Ù‚Ø§Ù„Û• Û‹Û• Ø³Û•Û‹Û•Ø¨Ù‰ØŒ Ø¦Ø§Ù„Ù‰Ø¯Ù‰ØºØ§Ù† ØªÛ•Ø¬Ø±Ù‰Ø¨Ù‰Ù„Û•Ø±Ø¯Ù‰Ù† 3 Ù†Ù‰ ÙŠØ§Ø².
6. **Ø¦Û•Ù…Û•Ù„Ù‰ÙŠ Ú¾Û•Ø±Ù‰ÙƒÛ•Øª Ø¦Ù‰Ø³ØªØ±Ø§ØªÛÚ¯Ù‰ÙŠÛ•Ø³Ù‰:** Ø¨Û‡ Ø¨Û†Ù„Û•Ùƒ Ø¨Û•Ùƒ Ù…Û‡Ú¾Ù‰Ù…. Ø¦ÙˆÙ…Û‡Ù…Ù‰ÙŠ Ø®Û‡Ù„Ø§Ø³Û• Û‹Û• ÙƒÙˆÙ†ÙƒØ±ÛØª Ù‚Û•Ø¯Û•Ù…-Ø¨Ø§Ø³Ù‚Û‡Ú†Ù„Ø§Ø±Ù†Ù‰ ÙŠØ§Ø². Â«Ø¦Ù‰Ø³ØªØ±Ø§ØªÛÚ¯Ù‰ÙŠÛ•Â» Ù‚Ù‰Ø³Ù…Ù‰Ù†Ù‰ Ø¨Ù‰Ø± Ù¾ÛˆØªÛˆÙ† ØªÛÙƒÙ‰Ø³Øª Ù‚Ù‰Ù„Ù…Ø§ÙŠØŒ Ú¾Û•Ø± Ø¨Ù‰Ø± Ù‚Û•Ø¯Û•Ù…Ù†Ù‰ Ø¦Ø§ÙŠØ±Ù‰Ù… ØªÛÙ…Ø§ Û‹Û• ØªÛ•Ù¾Ø³Ù‰Ù„Ø§ØªÙ‰ Ø¨Ù‰Ù„Û•Ù† Ø¨Û†Ù„ÛˆÙ¾ ÙŠØ§Ø² (JSON Ø¯Ø§ Array Ø´Û•ÙƒÙ„Ù‰Ø¯Û•). Ø´Û•Ø±Ù‚Ù‰ÙŠ ØªÛˆØ±ÙƒÙ‰Ø³ØªØ§Ù† Ù…Û‡Ø³ØªÛ•Ù‚Ù‰Ù„Ù„Ù‰Ù‚Ù‰ Ø¦ÛˆÚ†ÛˆÙ† Ø¦Û•Ù…Û•Ù„Ù‰ÙŠ Ø¯Û‡Ù†ÙŠØ§Ø¯Ù‰ÙƒÙ‰ Ù…Ù‰Ø³Ø§Ù„Ù„Ø§Ø± Ø¨Ù‰Ù„Û•Ù† Ø¦Û‡Ø²Û‡Ù† Û‹Û• Ù¾Ø§ÙŠØ¯Ù‰Ù„Ù‰Ù‚ ÙŠÛØ´Ù‰Ù¾ ØªÛ•Ú¾Ù„Ù‰Ù„ Ù‚Ù‰Ù¾ Ø¨Û•Ø±.
7. **Ø¦Ù‰Ø³Ù„Ø§Ù…Ù‰ÙŠ Ø¦Ø§Ù†Ø§Ù„Ù‰Ø²:** Ø¦Ù‰Ø³Ù„Ø§Ù…Ù‰ Ù†Û‡Ù‚ØªÙ‰Ø¯Ù‰Ù† Ø¨Û‡ Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ù†Ù‰ Ù‚Ø§Ù†Ø¯Ø§Ù‚ ØªÛ•Ú¾Ù„Ù‰Ù„ Ù‚Ù‰Ù„Ù‰Ø´ ÙƒÛØ±Û•ÙƒØŸ Ù…Û‡Ø³Û‡Ù„Ù…Ø§Ù† Ø¦Û‡ÙŠØºÛ‡Ø±Ù„Ø§Ø± Ù†ÛÙ…Û• Ù¾Ø§ÙŠØ¯Ø§ Ø¦Ø§Ù„Ù‰Ø¯Û‡ØŸ Ù‚Ø§ÙŠØ³Ù‰ Ù‚Û‡Ø±Ø¦Ø§Ù† Ø¦Ø§ÙŠÙ‰ØªÙ‰ ÙŠØ§ÙƒÙ‰ Ú¾Û•Ø¯Ù‰Ø³Ù†Ù‰ Ø¦Û•Ø³Ù„Û•Ø´ Ù…Û‡Ù…ÙƒÙ‰Ù†ØŸ Ø¦Ø§ÙŠÛ•Øª Û‹Û• Ú¾Û•Ø¯Ù‰Ø³Ù†Ù‰Ú­ Ø¦Û•Ø³Ù„Ù‰ Ø¦Û•Ø±Û•Ø¨Ú†Û• ØªÛÙƒÙ‰Ø³ØªÙ‰Ù†Ù‰ (Ú¾Û•Ø±Ù‰ÙƒÛ•ØªÙ„Ù‰Ø±Ù‰ Ø¨Ù‰Ù„Û•Ù† ØªÙˆÙ„Û‡Ù‚) Û‹Û• Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• Ù…Û•Ù†Ù‰Ø³Ù‰Ù†Ù‰ Ù‚ÙˆØ´Û‡Ù¾ ÙŠØ§Ø². ØªØ§Ø±Ù‰Ø®ØªÙ‰ÙƒÙ‰ Ø¦Ø§Ù„Ù‰Ù… ÙŠØ§ÙƒÙ‰ Û‹Û•Ù‚Û•Ù†Ù‰ Ù…Ù‰Ø³Ø§Ù„ Ù‚Ù‰Ù„.
8. **Ø¦Ø§ØªØ§Ù„ØºÛ‡Ù„Ø§Ø± (Technical Terms):** Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ø¯Ù‰ÙƒÙ‰ Ø¦Û•Ú­ Ù…Û‡Ú¾Ù‰Ù… 5 Ø³Ù‰ÙŠØ§Ø³Ù‰ÙŠ ÙŠØ§ÙƒÙ‰ Ø¦Ù‰Ù‚ØªÙ‰Ø³Ø§Ø¯Ù‰ÙŠ Ø¦Ø§ØªØ§Ù„ØºÛ‡. (Ø¦ÛÙ†Ú¯Ù„Ù‰Ø²Ú†Ù‰Ø³Ù‰ Û‹Û• Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• Ø¦Ù‰Ø²Ø§Ú¾Ø§ØªÙ‰).
9. **ÙƒÙ‰ØªØ§Ø¨ ØªÛ•Û‹Ø³Ù‰ÙŠÛ•Ø³Ù‰ (Book Recommendations):** Ù…Û‡Ø´Û‡ Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ø¯Ù‰ÙƒÙ‰ ØªÛÙ…Ù‰ØºØ§ Û‹Û• Ø´Û•Ø±Ù‚Ù‰ÙŠ ØªÛˆØ±ÙƒÙ‰Ø³ØªØ§Ù† Û‹Û•Ø²Ù‰ÙŠÙ‰ØªÙ‰Ú¯Û• Ù…Û‡Ù†Ø§Ø³Ù‰Û‹Û•ØªÙ„Ù‰Ùƒ 3 Ø¯Ø§Ù†Û• ÙƒÙ‰ØªØ§Ø¨Ù†Ù‰ ØªÙˆÙ†Û‡Ø´ØªÛ‡Ø±. (Ø¦ÛÙ†Ú¯Ù„Ù‰Ø²Ú†Û• Ø¦Ù‰Ø³Ù…Ù‰ØŒ ØªÛ•Ø±Ø¬Ù‰Ù…Ù‰Ø³Ù‰ØŒ Ø¦Ø§Ù¾ØªÙˆØ±Ù‰ØŒ Ù†Û•Ø´Ø± ÙŠÙ‰Ù„Ù‰ØŒ Ù‚Ù‰Ø³Ù‚Ù‰Ú†Û• Ù…Û•Ø²Ù…Û‡Ù†Ù‰ Û‹Û• Ø¨Ù‰Ø² Ø¦ÛˆÚ†ÛˆÙ† Ù¾Ø§ÙŠØ¯Ù‰Ø³Ù‰).

Ø¨Û•Ùƒ Ù…Û‡Ú¾Ù‰Ù…: Ù…Û•Ù† Ø³Ø§Ú­Ø§ Ø¨Û•Ø±Ú¯Ù‰Ù† Ø¨Ø§Ø±Ù„Ù‰Ù‚ Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ù†Ù‰ Ú†ÙˆÙ‚Û‡Ù… Ú¾Û•Ù…Ù…Ù‰Ù†Ù‰Ú­ Ø®Û‡Ù„Ø§Ø³Ù‰Ø³Ù‰Ù†Ù‰ 15 Ø¦Û‡Ø²Û‡Ù† Ø¬ÛˆÙ…Ù„Û• Ø¨Ù‰Ù„Û•Ù† Ù‚ÙˆØ´Û‡Ù¾ Ú†Ù‰Ù‚Ù‰Ø±Ù¾ Ø¨Û•Ø± Ø¦ÛØ³Ù‰Ú­Ø¯Û• Ø¨ÙˆÙ„Ø³Û‡Ù†ÙƒÙ‰ Ø¨Ù‰Ø±Ù…Û‡ Ù…Ø§Ù‚Ø§Ù„Û• Ú†ÛˆØ´ÛˆÙ¾ Ù‚Ø§Ù„Ù…Ù‰Ø³Û‡Ù†.

Ú¾ÛÚ†Ù‚Ø§Ù†Ø¯Ø§Ù‚ ÙŠÛ•Ø±Ú¯Û• Ù‚Û•ØªØ¦Ù‰ÙŠ Ø´Ù‰Ù†Ø¬Ø§Ú­ Ø¯Û•Ù¾ ÙŠØ§Ø²Ù…Ø§ Ú†ÙˆÙ‚Û‡Ù… Ø´Û•Ø±Ù‚Ù‰ÙŠ ØªÛˆØ±ÙƒÙ‰Ø³ØªØ§Ù† Ø¯Û•Ù¾ ÙŠØ§Ø².
Ø¬Û‡Ú­Ú¯ÙˆÙ†Ù‰ Ø®Ù‰ØªØ§ÙŠ Ø¯Û•Ù¾ ÙŠØ§Ø². Ù…Û‡Ú¾Ù‰Ù… Ø¦Ø§ØªØ§Ù„ØºÛ‡Ù‰Ù„Ø§Ø±Ù†Ù‰Ú­ Ø¦Û•Ø³Ù„Ù‰ ØªÙ‰Ù„Ø¯Ù‰ÙƒÙ‰ Ø¦Ø§ØªÙ‰Ù„Ù‰Ø´Ù‰Ù†Ù‰ ØªÙ‰Ø±Ù†Ø§Ù‚ Ø¦Ù‰Ú†Ù‰Ú¯Û• Ù‚ÙˆØ´Û‡Ù¾ Ù‚ÙˆÙŠØºÙ‰Ù†. ÙŠÛÚ­Ù‰ Ø¦Ø§ØªØ§Ù„ØºÛ‡Ù„Ø§Ø±Ù†Ù‰ Ø¦Û†Ú¯Ù‰Ù†Û•Ù„Û•ÙŠÙ…Û•Ù†.

### JSON ÙÙˆØ±Ù…Ø§ØªÙ‰ (Ù…Û‡Ø´Û‡ Ù‚ÛÙ„Ù‰Ù¾ØªØ§ Ù‚Ø§ÙŠØªÛ‡Ø±):
{
  "report_title": "Ø¯ÙˆÙƒÙ„Ø§Øª ØªÛÙ…Ù‰Ø³Ù‰",
  "grand_summary": { "uyghur": "...", "english": "...", "arabic": "..." },
  "articles": [ { "title": "...", "source": "...", "source_url": "https://...", "date": "...", "author": "...", "summary": "..." } ],
  "statistics": [ { "value": "...", "context": "...", "source_article": "..." } ],
  "quotes": [ { "text": "...", "speaker": "...", "source_article": "..." } ],
  "top_3_focus": [ { "article_title": "...", "reason": "...", "lesson": "..." } ],
  "action_plan": {
    "conclusion": "Ø¦ÙˆÙ…Û‡Ù…Ù‰ÙŠ Ø®Û‡Ù„Ø§Ø³Û•",
    "strategy_steps": [
       { "title": "1-Ù‚Û•Ø¯Û•Ù…: ØªÛÙ…Ù‰Ø³Ù‰", "detail": "ØªÛ•Ù¾Ø³Ù‰Ù„Ø§ØªÙ‰..." },
       { "title": "2-Ù‚Û•Ø¯Û•Ù…: ØªÛÙ…Ù‰Ø³Ù‰", "detail": "ØªÛ•Ù¾Ø³Ù‰Ù„Ø§ØªÙ‰..." }
    ]
  },
  "islamic_analysis": {
    "analysis": "...",
    "scripture": { "arabic": "...", "uyghur": "..." },
    "scholar_ref": "..."
  },
  "key_terms": [ { "term": "English Term", "definition": "Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û•..." } ],
  "books": [
    {
      "title_en": "...", "title_uy": "...", "author": "...", "year": "...",
      "summary": "...", "relevance": "..."
    }
  ]
}

---
ØªÛ†Û‹Û•Ù†Ø¯Ù‰ÙƒÙ‰Ø³Ù‰ Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±:
[Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø±Ù†Ù‰ Ú†Ø§Ù¾Ù„Ø§Ú­]</textarea>
                    <button onclick="copyPromptText()" class="absolute top-2 right-2 bg-sky-600 hover:bg-sky-700 text-white text-xs px-3 py-1.5 rounded shadow transition flex items-center gap-1">
                        ÙƒÛ†Ú†ÛˆØ±ÛˆØ´
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 flex-grow flex flex-col">
            <div class="bg-gray-50 p-4 border-b border-gray-100">
                <h2 class="font-bold text-gray-700 flex items-center gap-2">
                    <span class="bg-gray-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm">2</span>
                    JSON Ù†Û•ØªÙ‰Ø¬Ù‰Ø³Ù‰Ù†Ù‰ Ú†Ø§Ù¾Ù„Ø§Ø´
                </h2>
            </div>
            <textarea id="jsonInput" class="w-full flex-grow p-4 font-mono text-xs ltr bg-white focus:ring-2 focus:ring-sky-500 outline-none" placeholder='AI Ú†Ù‰Ù‚Ù‰Ø±Ù‰Ù¾ Ø¨Û•Ø±Ú¯Û•Ù† JSON ÙƒÙˆØ¯Ù‰Ù†Ù‰ Ú†Ø§Ù¾Ù„Ø§Ú­...' dir="ltr"></textarea>
            <div class="p-4 border-t border-gray-100 grid grid-cols-2 gap-3">
                <button onclick="generateReport()" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg shadow">âš¡ ÙƒÛ†Ø±ÛˆØ´</button>
                <button onclick="downloadHtml()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow">ğŸ’¾ HTML Ø³Ø§Ù‚Ù„Ø§Ø´</button>
            </div>
        </div>
    </div>

    <!-- Right Side: Preview -->
    <div class="w-full lg:w-2/3 bg-slate-200 rounded-xl border border-slate-300 overflow-hidden relative shadow-inner">
        <iframe id="previewFrame" class="w-full h-full bg-white"></iframe>
    </div>
</div>

<!-- Main Logic Script -->
<script>
    function copyPromptText() {
        const promptText = document.getElementById('aiPrompt');
        promptText.select();
        promptText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(promptText.value).then(() => {
            alert("Ø¨Û‡ÙŠØ±Û‡Ù‚ (Prompt) ÙƒÛ†Ú†ÛˆØ±ÛˆÙ„Ø¯Ù‰!");
        });
    }

    // HTML Template Generator
    function getTemplate(data) {
        const d = new Date();
        const dateStr = `${d.getFullYear()}-ÙŠÙ‰Ù„Ù‰ ${d.getMonth() + 1}-Ø¦Ø§ÙŠÙ†Ù‰Ú­ ${d.getDate()}-ÙƒÛˆÙ†Ù‰`;

        // Articles (Modified to include clickable Source URL)
        const articlesHtml = data.articles.map((art, i) => {
            const sourceDisplay = art.source_url
                ? `<a href="${art.source_url}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline transition">ğŸ”— ${art.source}</a>`
                : `<span>ğŸ”— ${art.source}</span>`;

            return `
                <div class="mb-6 pb-6 border-b border-gray-100 last:border-0">
                    <h4 class="text-lg font-bold text-sky-800 mb-2">${i+1}. ${art.title}</h4>
                    <div class="flex flex-wrap gap-4 text-xs text-gray-500 mb-3 font-mono bg-gray-50 p-2 rounded">
                        <span>âœï¸ ${art.author}</span>
                        <span>ğŸ—“ï¸ ${art.date}</span>
                        ${sourceDisplay}
                    </div>
                    <p class="text-gray-700 text-sm leading-relaxed text-justify">${art.summary}</p>
                </div>`;
        }).join('');

        // Strategy Steps (Block Style)
        let strategyHtml = '';
        if (data.action_plan.strategy_steps && Array.isArray(data.action_plan.strategy_steps)) {
            strategyHtml = data.action_plan.strategy_steps.map((step, i) => `
                    <div class="bg-white/10 p-4 rounded-lg border border-white/20 mb-4">
                        <h4 class="font-bold text-yellow-400 mb-2 flex items-center gap-2">
                            <span class="bg-yellow-500 text-slate-900 w-5 h-5 rounded-full flex items-center justify-center text-xs">${i+1}</span>
                            ${step.title}
                        </h4>
                        <p class="text-sm leading-relaxed text-gray-100 pl-7">${step.detail}</p>
                    </div>`).join('');
        } else {
            strategyHtml = `<div class="bg-white/10 p-4"><p class="text-sm text-gray-100">${data.action_plan.strategy}</p></div>`;
        }

        // Books
        let booksHtml = '';
        if (data.books) {
            booksHtml = data.books.map(book => `
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-200 shadow-sm">
                        <h4 class="font-bold text-amber-900 mb-1">ğŸ“– ${book.title_uy}</h4>
                        <p class="text-xs text-amber-700 italic mb-2 dir-ltr text-right">"${book.title_en}" (${book.year})</p>
                        <p class="text-sm text-gray-700 mb-2">${book.summary}</p>
                        <p class="text-xs text-sky-700 bg-white p-2 rounded border border-amber-100">ğŸ’¡ ${book.relevance}</p>
                    </div>`).join('');
        }

        // Terms
        let termsHtml = '';
        if (data.key_terms) {
            termsHtml = data.key_terms.map(item => `
                    <div class="flex justify-between items-start border-b border-gray-100 pb-2 mb-2">
                        <div class="text-right text-sm font-bold text-gray-700">${item.definition}</div>
                        <div class="text-left font-mono text-xs text-sky-600 bg-sky-50 px-2 py-1 rounded" dir="ltr">${item.term}</div>
                    </div>`).join('');
        }

        // Stats
        const statsHtml = data.statistics.map(s => `
                <div class="flex items-start gap-3 p-3 bg-white rounded border border-gray-100 shadow-sm mb-2">
                    <div class="text-sky-600 text-xl">ğŸ“Š</div>
                    <div><div class="font-bold text-gray-800 font-mono">${s.value}</div><div class="text-xs text-gray-500">${s.context}</div></div>
                </div>`).join('');

        // Top 3
        const top3Html = data.top_3_focus.map((item, i) => `
                <div class="bg-gradient-to-br from-white to-sky-50 p-4 rounded-lg border border-sky-200 shadow-sm mb-4 relative">
                    <div class="absolute top-0 right-0 bg-sky-600 text-white px-2 py-1 text-xs font-bold rounded-bl">TOP ${i+1}</div>
                    <h4 class="font-bold text-sky-900 mt-4 text-sm">${item.article_title}</h4>
                    <p class="text-xs text-gray-600 mt-2"><strong>Ø³Û•Û‹Û•Ø¨Ù‰:</strong> ${item.reason}</p>
                </div>`).join('');

        // Quotes
        const quotesHtml = data.quotes.map(q => `
                <blockquote class="border-r-4 border-sky-500 pr-3 py-2 bg-slate-50 rounded mb-3">
                    <p class="text-sm text-gray-800 italic">Â«${q.text}Â»</p>
                    <footer class="text-xs text-gray-500 mt-1">â€” ${q.speaker}</footer>
                </blockquote>`).join('');

        return `<!DOCTYPE html>
<html lang="ug" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>${data.report_title}</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @font-face { font-family: 'UKIJ Ekran'; src: local('UKIJ Ekran'), local('UKIJ_Ekran'); }
        @font-face { font-family: 'UKIJ Tuz'; src: local('UKIJ Tuz'), local('UKIJ_Tuz'); }
        body { font-family: "UKIJ Ekran", "ALKATIP Tor", "Noto Naskh Arabic", sans-serif; background: #f8fafc; }
        .font-tuz { font-family: "UKIJ Tuz", sans-serif; }
        .quran-font { font-family: 'Amiri', serif; }
        a { text-decoration: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="report-content" class="p-8 max-w-5xl mx-auto text-gray-800 bg-white shadow-2xl my-8 rounded-xl">
        <header class="text-center mb-12 py-10 rounded-xl bg-sky-700 text-white shadow-lg">
            <h1 class="text-4xl font-bold mb-3 drop-shadow-md">Ø¨Ù‰Ù„Ù‰Ùƒ ØªÛ•ØªÙ‚Ù‰Ù‚Ø§Øª Ù…Û•Ø±ÙƒÙ‰Ø²Ù‰</h1>
            <h2 class="text-2xl font-tuz mb-4 text-sky-100 tracking-wide">${data.report_title}</h2>
            <div class="inline-block bg-sky-800 border border-sky-500 text-white px-5 py-1.5 rounded-full text-sm font-bold shadow-sm">Ø¯ÙˆÙƒÙ„Ø§Øª Û‹Ø§Ù‚ØªÙ‰: ${dateStr}</div>
        </header>

        <section class="mb-12 bg-white p-8 rounded-2xl shadow-inner border border-gray-100 border-t-8 border-sky-600">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-sky-600">â—ˆ Ø¦ÙˆÙ…Û‡Ù…Ù‰ÙŠ Ø®Û‡Ù„Ø§Ø³Û•</h3>
            <div class="space-y-6">
                <div><h4 class="font-bold text-sky-800 mb-2">Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û•</h4><p class="text-gray-700 leading-8 text-justify">${data.grand_summary.uyghur}</p></div>
                <div id="foreign-summaries" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div id="summary-en" class="bg-gray-50 p-4 rounded" dir="ltr"><h4 class="font-bold text-xs uppercase">English</h4><p class="text-sm font-serif">${data.grand_summary.english}</p></div>
                    <div id="summary-ar" class="bg-green-50 p-4 rounded"><h4 class="font-bold text-sm">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h4><p class="text-sm font-serif">${data.grand_summary.arabic}</p></div>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <section class="bg-white p-6 rounded-xl border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 border-b-2 border-sky-100 pb-2">Ù…Ø§Ù‚Ø§Ù„Ù‰Ù„Û•Ø± Ø¦Ø§Ù†Ø§Ù„Ù‰Ø²Ù‰</h3>
                    ${articlesHtml}
                </section>
                <section class="bg-gradient-to-r from-slate-800 to-slate-900 text-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-sky-400 mb-4">âš¡ Ú¾Û•Ø±Ù‰ÙƒÛ•Øª Ù‚ÙˆÙ„Ù„Ø§Ù†Ù…Ù‰Ø³Ù‰</h3>
                    <div class="mb-6"><p class="leading-relaxed opacity-90">${data.action_plan.conclusion}</p></div>
                    <h4 class="font-bold text-yellow-400 mb-4">Ø¦Û•Ù…Û•Ù„Ù‰ÙŠ Ø¦Ù‰Ø³ØªØ±Ø§ØªÛÚ¯Ù‰ÙŠÛ•:</h4>
                    ${strategyHtml}
                </section>
                <section class="bg-white p-6 rounded-xl border border-amber-100 shadow-sm">
                    <h3 class="text-xl font-bold text-amber-800 mb-6">ğŸ“š ØªÛ•Û‹Ø³Ù‰ÙŠÛ• ÙƒÙ‰ØªØ§Ø¨Ù„Ø§Ø±</h3>
                    <div class="grid grid-cols-1 gap-4">${booksHtml}</div>
                </section>
            </div>

            <div class="space-y-8">
                <section><h3 class="text-lg font-bold text-gray-800 mb-4">Ø¦Û•Ú­ Ù…Û‡Ú¾Ù‰Ù… 3 Ù…Ø§Ù‚Ø§Ù„Û•</h3>${top3Html}</section>
                <section class="bg-green-50 p-6 rounded-xl border-t-4 border-green-600 shadow-sm">
                    <h3 class="text-lg font-bold text-green-800 mb-4">â˜ªï¸ Ø¦Ù‰Ø³Ù„Ø§Ù…Ù‰ÙŠ Ù†Û‡Ù‚ØªÙ‰Ù†Û•Ø²Û•Ø±</h3>
                    <p class="text-sm text-gray-700 mb-4 text-justify leading-7">${data.islamic_analysis.analysis}</p>
                    <div class="bg-white p-6 rounded border border-green-100 mb-3 text-center shadow-inner">
                        <p class="quran-font text-2xl text-green-900 mb-3 leading-loose" dir="rtl">${data.islamic_analysis.scripture.arabic}</p>
                        <p class="text-xs text-gray-500 border-t border-gray-100 pt-3">${data.islamic_analysis.scripture.uyghur}</p>
                    </div>
                    <div class="text-xs text-green-700 font-bold text-right">Ø¦Û†Ø±Ù†Û•Ùƒ: ${data.islamic_analysis.scholar_ref}</div>
                </section>
                <section class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Ø¦Ø§ØªØ§Ù„ØºÛ‡Ù„Ø§Ø±</h3>${termsHtml}
                </section>
                <section><h3 class="text-lg font-bold text-gray-800 mb-4">Ø³Ù‰ØªØ§ØªÙ‰Ø³ØªÙ‰ÙƒØ§</h3>${statsHtml}</section>
                <section><h3 class="text-lg font-bold text-gray-800 mb-4">Ù†Û•Ù‚Ù‰Ù„Ù„Û•Ø±</h3>${quotesHtml}</section>
            </div>
        </div>
        <footer class="mt-16 text-center text-gray-400 text-sm border-t border-gray-200 pt-8">Bilik Research Center Analysis Tool</footer>
    </div>
    <div class="h-24"></div>

    <!-- Compact Floating Controls -->
    <div id="controlsContainer" class="fixed bottom-4 left-4 z-50 flex items-end gap-2" data-html2canvas-ignore="true">
        <!-- Toggle Button -->
        <button onclick="toggleControls()" id="toggleBtn" class="bg-slate-800 text-white w-8 h-8 rounded-full shadow-xl flex items-center justify-center text-xs hover:bg-slate-700 transition">âš™ï¸</button>

        <!-- Main Panel (Hidden by default) -->
        <div id="controlPanelMain" class="hidden bg-slate-900/95 backdrop-blur-sm p-2 rounded-lg shadow-2xl border border-slate-700 flex flex-col gap-2 w-64">
            <div class="flex gap-1">
                <select id="voiceSelect" class="bg-slate-700 text-white text-[10px] p-1 rounded w-full dir-ltr focus:outline-none focus:ring-1 focus:ring-sky-500">
                    <option value="ug-UG0">Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• (Ø¦Û•Ø±)</option>
                    <option value="ug-UG">Ø¦Û‡ÙŠØºÛ‡Ø±Ú†Û• (Ø¦Ø§ÙŠØ§Ù„)</option>
                    <option value="ar-SA">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø¦Û•Ø±Û•Ø¨Ú†Û•)</option>
                    <option value="en-US">English (Ø¦ÛÙ†Ú¯Ù„Ù‰Ø²Ú†Û•)</option>
                </select>
                <select id="rateSelect" class="bg-slate-700 text-white text-[10px] p-1 rounded w-14 text-center focus:outline-none focus:ring-1 focus:ring-sky-500">
                    <option value="1.0">1.0x</option>
                    <option value="1.5" selected>1.5x</option>
                    <option value="2.0">2.0x</option>
                </select>
            </div>
            <div class="grid grid-cols-5 gap-1">
                <button onclick="prevChunk()" class="bg-slate-600 hover:bg-slate-500 text-white p-1.5 rounded text-[10px] font-bold" title="Ø¦Ø§Ù„Ø¯Ù‰Ù†Ù‚Ù‰">â®</button>
                <button onclick="startReading()" class="bg-sky-600 hover:bg-sky-500 text-white p-1.5 rounded text-[10px] font-bold" title="Ø¦ÙˆÙ‚Û‡Ø´">â–¶</button>
                <button onclick="nextChunk()" class="bg-indigo-600 hover:bg-indigo-500 text-white p-1.5 rounded text-[10px] font-bold" title="ÙƒÛÙŠÙ‰Ù†ÙƒÙ‰">â­</button>
                <button onclick="stopReading()" class="bg-red-600 hover:bg-red-500 text-white p-1.5 rounded text-[10px] font-bold" title="ØªÙˆØ®ØªØ§">â– </button>
                <button onclick="savePDF()" class="bg-pink-600 hover:bg-pink-500 text-white p-1.5 rounded text-[10px] font-bold" title="PDF">ğŸ“„</button>
            </div>
        </div>
    </div>

    <script>
        // Mapping
        const UY_TO_ULY_MAP = {'Ø§':'a','Û•':'e','Ø¨':'b','Ù¾':'p','Øª':'t','Ø¬':'j','Ú†':'ch','Ø®':'x','Ø¯':'d','Ø±':'r','Ø²':'z','Ú˜':'zh','Ø³':'s','Ø´':'sh','Øº':'gh','Ù':'f','Ù‚':'q','Ùƒ':'k','Ú¯':'g','Ú­':'ng','Ù„':'l','Ù…':'m','Ù†':'n','Ú¾':'h','Ùˆ':'o','Û‡':'u','Û†':'o','Ûˆ':'u','ÙŠ':'y','Û‹':'v','Û':'e','Ù‰':'i','Ø¦':'','ØŸ':'?'};
        const UY_TO_ULY_MAPT = {'Ø§':'a','Û•':'e','Ø¨':'b','Ù¾':'p','Øª':'t','Ø¬':'c','Ú†':'Ã§','Ø®':'hh','Ø¯':'d','Ø±':'r','Ø²':'z','Ú˜':'j','Ø³':'s','Ø´':'ÅŸ','Øº':'gh','f':'f','Ù‚':'k','Ùƒ':'k','Ú¯':'g','Ú­':'n','Ù„':'l','Ù…':'m','Ù†':'n','Ú¾':'h','Ùˆ':'o','Û‡':'u','Û†':'Ã¶','Ûˆ':'Ã¼','ÙŠ':'y','Û‹':'v','Û':'e','Ù‰':'i','Ø¦':'','ØŸ':'?'};

        function convertForTTS(text, map) {
            return text.split('').map(c => map[c] || c).join('');
        }

        let chunks = [];
        let chunkIndex = 0;
        let isReading = false;

        function toggleControls() {
            const panel = document.getElementById('controlPanelMain');
            const btn = document.getElementById('toggleBtn');
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                btn.innerHTML = 'â–¼';
            } else {
                panel.classList.add('hidden');
                btn.innerHTML = 'âš™ï¸';
            }
        }

        function startReading() {
            stopReading();
            isReading = true;

            const voiceVal = document.getElementById('voiceSelect').value;
            const reportEl = document.getElementById('report-content');
            let clone = reportEl.cloneNode(true);
            let fullText = "";

            // --- Language Logic ---
            if (voiceVal === 'ar-SA') {
                // Read ONLY Arabic Summary
                const arSummary = clone.querySelector('#summary-ar p');
                fullText = arSummary ? arSummary.innerText : "ØªÛÙƒÙ‰Ø³Øª ØªÛÙ¾Ù‰Ù„Ù…Ù‰Ø¯Ù‰";
            } else if (voiceVal === 'en-US') {
                // Read ONLY English Summary
                const enSummary = clone.querySelector('#summary-en p');
                fullText = enSummary ? enSummary.innerText : "Text not found";
            } else {
                // Uyghur Mode: Read Everything EXCEPT Foreign Summaries
                const foreignEl = clone.querySelector('#foreign-summaries');
                if (foreignEl) foreignEl.remove();
                fullText = clone.innerText;
            }

            // --- Chunking & Deduplication ---
            let rawChunks = fullText.split(/\\n+/);
            chunks = [];
            let lastChunk = "";
            for (let i = 0; i < rawChunks.length; i++) {
                let clean = rawChunks[i].trim();
                if (clean.length > 0 && clean !== lastChunk) {
                    chunks.push(clean);
                    lastChunk = clean;
                }
            }

            chunkIndex = 0;
            speakNextChunk();
        }

        function speakNextChunk() {
            if (!isReading) return;
            if (chunkIndex >= chunks.length) {
                isReading = false;
                return;
            }

            const voiceVal = document.getElementById('voiceSelect').value;
            const rateVal = parseFloat(document.getElementById('rateSelect').value);
            let chunkText = chunks[chunkIndex];
            let finalText = chunkText;

            // Apply mapping only for Uyghur voices
            if(voiceVal === 'ug-UG0') finalText = convertForTTS(chunkText, UY_TO_ULY_MAPT);
            else if (voiceVal === 'ug-UG') finalText = convertForTTS(chunkText, UY_TO_ULY_MAP);

            const utterance = new SpeechSynthesisUtterance(finalText);
            const voices = window.speechSynthesis.getVoices();
            let chosenVoice = null;

            if(voiceVal === 'ug-UG0') chosenVoice = voices.find(v => v.lang === 'tr-TR');
            else if (voiceVal === 'ug-UG') chosenVoice = voices.find(v => v.lang === 'uz-UZ' && v.name.includes('Madina')) || voices.find(v => v.lang.includes('tr'));
            else chosenVoice = voices.find(v => v.lang === voiceVal);

            if(chosenVoice) utterance.voice = chosenVoice;
            utterance.rate = rateVal;

            utterance.onend = function() {
                if (isReading) {
                    chunkIndex++;
                    speakNextChunk();
                }
            };
            utterance.onerror = function() { if (isReading) { chunkIndex++; speakNextChunk(); } };

            window.speechSynthesis.speak(utterance);
        }

        function nextChunk() {
            if (!isReading || chunks.length === 0) return;
            window.speechSynthesis.cancel(); // Trigger onend -> Next
        }

        function prevChunk() {
            if (!isReading || chunks.length === 0) return;
            // Logic: cancel() triggers onend (index++).
            // We want index to go back 1.
            // So: index - 2 + 1 (from onend) = index - 1.
            if (chunkIndex > 0) {
                chunkIndex -= 2;
                if (chunkIndex < -1) chunkIndex = -1; // Bound check
                window.speechSynthesis.cancel();
            }
        }

        function stopReading() {
            isReading = false;
            window.speechSynthesis.cancel();
        }

        function savePDF() {
            const el = document.getElementById('report-content');
            // Generate filename with seconds
            const d = new Date();
            const f = (n) => n.toString().padStart(2, '0');
            const fname = \`Bilik_Report_\${d.getFullYear()}-\${f(d.getMonth()+1)}-\${f(d.getDate())}_\${f(d.getHours())}-\${f(d.getMinutes())}-\${f(d.getSeconds())}.pdf\`;

            const opt = { margin: [10,10,10,10], filename: fname, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' } };
            html2pdf().set(opt).from(el).save();
        }
    <\/script>
</body>
</html>`;
    }

    // Action Functions
    function generateReport() {
        const jsonInput = document.getElementById('jsonInput').value;
        const previewFrame = document.getElementById('previewFrame');

        if (!jsonInput.trim()) { alert("JSON ÙƒÙˆØ¯Ù‰Ù†Ù‰ Ú†Ø§Ù¾Ù„Ø§Ú­!"); return; }

        try {
            const cleanJson = jsonInput.replace(/```json/g, '').replace(/```/g, '').trim();
            const data = JSON.parse(cleanJson);
            const htmlContent = getTemplate(data);

            const blob = new Blob([htmlContent], { type: 'text/html' });
            previewFrame.src = URL.createObjectURL(blob);
        } catch (e) {
            alert("JSON Ø®Ø§ØªØ§Ù„Ù‰Ù‚Ù‰:\n" + e.message);
        }
    }

    function downloadHtml() {
        const jsonInput = document.getElementById('jsonInput').value;
        try {
            const cleanJson = jsonInput.replace(/```json/g, '').replace(/```/g, '').trim();
            const data = JSON.parse(cleanJson);
            const htmlContent = getTemplate(data);

            // Filename with seconds
            const d = new Date();
            const f = (n) => n.toString().padStart(2, '0');
            const fname = `Bilik_Report_${d.getFullYear()}-${f(d.getMonth()+1)}-${f(d.getDate())}_${f(d.getHours())}-${f(d.getMinutes())}-${f(d.getSeconds())}.html`;

            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([htmlContent], { type: 'text/html' }));
            a.download = fname;
            a.click();
        } catch (e) {
            alert("JSON Ø®Ø§ØªØ§Ù„Ù‰Ù‚Ù‰:\n" + e.message);
        }
    }
</script>
</body>
</html>
