<!DOCTYPE html>
<html lang="ug">
<head>
    <meta charset="UTF-8">
    <title>Gemini بىلەن پاراڭ</title>
    <style>
      @font-face {
            font-family: 'ALKATIP' ;
            src: url('https://websim.ai/fonts/ALKATIP.ttf') format('truetype');
        }

        * {
            direction: rtl;
        }

        body {
            background-color: #1f1f1f;
            color: #fff;
            font-family: 'ALKATIP', sans-serif !important;
            padding-bottom: 150px; /* Footer ئۈچۈن بوشلۇق */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        #geminiApiKey {
            font-family: 'ALKATIP', sans-serif !important;
            background-color: #292929;
            color: #fff;
            border: 1px solid #444;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            height: 40px;
            margin-bottom: 10px;
            direction: ltr !important;
        }

        #questionInput {
            background-color: #292929;
            color: #fff;
            border: 1px solid #444;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            height: 120px;
            resize: vertical;
            font-family: 'ALKATIP', sans-serif !important;
            margin-bottom: 10px;
        }

        #answerOutput {
            background-color: #292929;
            color: #fff;
            border: 1px solid #444;
            padding: 15px;
            width: 100%;
            box-sizing: border-box;
            min-height: 200px;
            font-family: 'ALKATIP', sans-serif !important;
            white-space: pre-wrap; /* جاۋابتىكى قۇرلارنى ساقلايدۇ */
            line-height: 1.8;
            margin-top: 10px;
            text-align: justify;
        }

        #answerOutput b, #answerOutput strong {
            color: #00d1a7; /* قېلىن يېزىلغان تېكىستلەرنىڭ رەڭگى */
        }

        #submitBtn, #readAnswerBtn, #saveHistoryBtn {
            background-color: #00d1a7;
            color: #fff;
            border: 1px solid #555;
            padding: 12px 20px;
            cursor: pointer;
            font-family: 'ALKATIP', sans-serif !important;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #submitBtn:hover, #readAnswerBtn:hover, #saveHistoryBtn:hover {
            background-color: #444;
        }

        #submitBtn:disabled {
            background-color: #222;
            color: #777;
            cursor: not-allowed;
        }

        #a {
            color: #b6b5b5;
            font-size: small;
            padding: 20px 0;
            font-style: italic;
            display: block;
        }

        #b {
            color: #009b74;
            font-size: xx-large;
            text-align: center;
        }

        .tts-controls {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .tts-controls label, .tts-controls select {
            font-family: 'ALKATIP', sans-serif !important;
        }

        .tts-controls select {
            background-color: #292929;
            color: #fff;
            border: 1px solid #444;
            padding: 5px;
            height: 40px;
        }

        /* History Table Styles */
        #historyTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
        }

        #historyTable th, #historyTable td {
            border: 1px solid #444;
            padding: 12px;
            text-align: right;
            vertical-align: top;
        }

        #historyTable th {
            background-color: #009b74;
            color: #fff;
        }

        #historyTable td {
            background-color: #2c2c2c;
            text-align: justify;
            white-space: pre-wrap; /* جاۋابلارنى فورماتى بىلەن ساقلاش */
        }

        #saveHistoryBtn {
            margin-top: 20px;
            width: 100%;
            background-color: #009b74;
        }
        #saveHistoryBtn:hover {
            background-color: #007a5c;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        .footer #contact {
            color: #b6b5b5;
            font-size: small;
            font-style: italic;
            display: block;
            margin-bottom: 10px;
        }

        .footer a {
            margin: 0 8px;
        }


        /* Style for the navbar */
        .navbar {
            overflow: hidden;
            background-color: #333;
            position: fixed;
            top: 0;
            width: 100%;

            display: flex;
            justify-content: center;
        }

        .navbar a {
            float: left;
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;

        }

        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }


    </style>
</head>
<body>




<div class="navbar" >
    <a href="./Tools/IsilTerjiman.html"> تەرجىمان</a>
    <a href="./Tools/HikmetlerHezinesi.html" >ھىكمەت</a>
    <a href="./Tools/TextToSpeachUy.html"> ئاڭلاش</a>
    <a href="index.html">Gemini</a>
    <a href="./Tools/wordcounter.html"> تېكىست </a>
    <a href="./Tools/wordreplacer.html"> ئىملا </a>
    <a href="./Tools/teshkil.html">تەشكىل</a>
    <a href="https://www.yulghun.com/tools/"> يۇلغۇن </a>
    <a href="https://translate.google.com.tr/?sl=auto&tl=ug&text=I%20can%20translate%20uyghur%20language%20to%20english&op=translate" target="_blank"> Google </a>
</div>




<div class="container">
    <h id="b">.  </h>
    <h1 id="b">Gemini 2.0 نىڭ ئۇيغۇرچە نۇسخىسى</h1>
    <label>AIzaSyCkpkBDY_HmxOQIwEmILG6M-9t2ek6kObU</label>
    <label>AIzaSyCJVkxlcjZ0bhH_RuSeQfJ2mUhpo5eSBt4</label>
    <label>AIzaSyD5R8LACkmHhs5oGin7Bgw4x5TrRSLX9so</label>
    <label>AIzaSyAx4RBhcktpftd5m-SYf0RYlDipkW4jsh0</label>
    <input type="password" id="geminiApiKey" placeholder="سىزگە تەۋە Gemini نىڭ API Key نى كىرگۈزۈڭ">
    <textarea id="questionInput" placeholder="سورىماقچى بولغان سۆزىڭىزنى بۇ يەرگە يېزىڭ"></textarea>
    <button id="submitBtn">جاۋاب بەر</button>

    <div id="answerOutput" placeholder="سۈنئىي ئىدراكنىڭ جاۋابى بۇ يەردە چىقىدۇ."></div>

    <div class="tts-controls">
        <button id="readAnswerBtn">جاۋابنى ئوقۇ</button>
        <label for="language">ئاۋاز تاللاڭ:</label>
        <select id="language">
            <option value="ug-UG0">ئۇيغۇرچە (تۈركچە ئاھاڭ)</option>
            <option value="ug-UG1">ئۇيغۇرچە (ئۆزبېكچە ئاھاڭ - ئەر)</option>
            <option value="ug-UG">ئۇيغۇرچە (ئۆزبېكچە ئاھاڭ - ئايال)</option>
            <option value="ug-UG2">ئۇيغۇرچە (تۈركچە ئاھاڭ - ئەھمەت)</option>
            <option value="tr-TR">تۈركچە</option>
            <option value="en-US">ئىنگلىزچە</option>
            <option value="ar-SA">ئەرەبچە</option>
            <option value="zh-CN">خىتايچە</option>
        </select>
        <label for="rate">سۈرئەت:</label>
        <select id="rate">
            <option value="1.0">1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
            <option value="1.75">1.75x</option>
            <option value="2.0">2.0x</option>
            <option value="0.5">0.5x</option>
            <option value="0.75">0.75x</option>
        </select>
    </div>

    <ab id="a">بۇ تور ئەپ Gemini 2.0 flash مودېلىنىڭ API'سىنى ئىشلىتىپ، سىزنىڭ سۇئاللىرىڭىزغا ئۇيغۇرچە جاۋاب بېرىدۇ. سۇئال سوراشتىن بۇرۇن، Google AI Studio دىن ئالغان ئۆزىڭىزنىڭ API Key'نى كىرگۈزۈشىڭىز كېرەك. جاۋاب چىققاندىن كېيىن «جاۋابنى ئوقۇ» كۇنۇپكىسى ئارقىلىق ئاڭلىيالايسىز (Edge تور كۆرگۈچى تەۋسىيە قىلىنىدۇ).</ab>

    <h2 style="text-align: center; color: #009b74; margin-top: 40px;">سۆھبەت خاتىرىسى</h2>
    <table id="historyTable">
        <thead>
        <tr>
            <th>سۇئال</th>
            <th>جاۋاب</th>
        </tr>
        </thead>
        <tbody id="historyBody"></tbody>
    </table>
    <button id="saveHistoryBtn" style="display: none;">خاتىرىلەرنى ساقلا</button>

</div>

<footer class="footer">
    <ba id="contact">مېنى بۇ يەردىن ئىزدەڭ</ba>
    <a href="https://uycoder.github.io/paydilar/" target="_blank">
        <img src="https://raw.githubusercontent.com/UyCoder/paydilar/master/pics/favicon.png" height="25">
    </a>
    <a href="https://www.linkedin.com/in/ahmed-bughra/" target="_blank">
        <img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/LinkedIn.svg" alt="linkedin" height="25">
    </a>
    <a href="https://github.com/Uycoder" target="_blank">
        <img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/github.svg" alt="github" height="25">
    </a>
    <a href="https://www.hackerrank.com/ahmedbughra" target="_blank">
        <img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/hackerrank.svg" alt="hackerrank" height="25">
    </a>
    <a href="https://stackoverflow.com/users/16111723/ahmad-ali" target="_blank">
        <img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/Stack_Overflow.svg" alt="stackoverflow" height="25">
    </a>
</footer>

<script>
    // HTML Elementلىرىنى تۇتۇۋېلىش
    const geminiApiKeyInput = document.getElementById('geminiApiKey');
    const questionInput = document.getElementById('questionInput');
    const submitBtn = document.getElementById('submitBtn');
    const answerOutput = document.getElementById('answerOutput');

    // ئاۋازلىق ئوقۇشقا ئائىت Elementلار
    const readAnswerBtn = document.getElementById('readAnswerBtn');
    const languageSelect = document.getElementById('language');
    const rateSelect = document.getElementById('rate');
    let currentUtterance = null;

    // خاتىرىگە ئائىت Elementلار
    const historyBody = document.getElementById('historyBody');
    const saveHistoryBtn = document.getElementById('saveHistoryBtn');

    // كۇنۇپكىلارغا ھادىسە قوشۇش
    submitBtn.addEventListener('click', handleGeminiRequest);
    readAnswerBtn.addEventListener('click', speakAnswer);
    saveHistoryBtn.addEventListener('click', downloadHistory);


    // Gemini API غا سۇئال يوللاش فۇنكسىيەسى
    async function handleGeminiRequest() {
        const apiKey = geminiApiKeyInput.value.trim();
        const question = questionInput.value.trim();

        if (!apiKey) {
            alert('Gemini API ئاچقۇچىنى كىرگۈزۈڭ!');
            return;
        }
        if (!question) {
            alert('سورىماقچى بولغان سۇئالنى كىرگۈزۈڭ!');
            return;
        }

        // UI نى يېڭىلاش (يۈكلىنىش ھالىتى)
        submitBtn.disabled = true;
        submitBtn.textContent = 'ساقلاڭ، جاۋاب كېلىۋاتىدۇ...';
        answerOutput.innerHTML = 'سۈنئىي ئىدراكقا سۇئال يوللاندى، جاۋابنى تەييارلاۋاتىدۇ...';

        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        const requestBody = {
            "contents": [{
                "parts": [{ "text": question }]
            }],
            "generationConfig": { // تېمپىراتۇرا ۋە باشقا تەڭشەكلەر
                "temperature": 0.7,
                "topP": 1,
                "topK": 1
            }
        };

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API خاتالىقى: ${errorData.error.message}`);
            }

            const data = await response.json();

            let answerText = "كەچۈرۈڭ، Gemini دىن جاۋاب ئالغىلى بولمىدى.";
            if (data.candidates && data.candidates.length > 0) {
                if (data.candidates[0].content && data.candidates[0].content.parts) {
                    answerText = data.candidates[0].content.parts[0].text;
                } else if (data.candidates[0].finishReason === 'SAFETY') {
                    answerText = "بۇ سۇئالغا جاۋاب بېرىش بىخەتەرلىك قائىدىسىگە خىلاپ دەپ قارالدى.";
                }
            }

            // جاۋابنى فورماتلاپ كۆرسىتىش
            answerOutput.innerHTML = formatGeminiResponse(answerText);

            // خاتىرىگە قوشۇش
            addToHistory(question, answerText);

        } catch (error) {
            console.error("Gemini API غا ئۇلىنىشتا خاتالىق:", error);
            answerOutput.innerHTML = `<b style="color:red;">خاتالىق: ${error.message}</b><br>API ئاچقۇچىنىڭ توغرىلىقىنى ياكى تور ئۇلىنىشىڭىزنى تەكشۈرۈڭ.`;
        } finally {
            // UI نى ئەسلىگە كەلتۈرۈش
            submitBtn.disabled = false;
            submitBtn.textContent = 'جاۋاب بەر';
        }
    }

    // Gemini دىن كەلگەن جاۋابنى HTML فورماتىغا ئايلاندۇرۇش
    function formatGeminiResponse(text) {
        // قېلىن يېزىقنى (**) <b> tag غا ئايلاندۇرۇش
        let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        // يەككە يۇلتۇزچىلارنى بىرتەرەپ قىلىش (ئەگەر كېرەك بولسا)
        formattedText = formattedText.replace(/(^|\s)\*(.*?)\*(\s|$)/g, '$1<i>$2</i>$3');
        // يېڭى قۇرنى <br> غا ئايلاندۇرۇش
        return formattedText.replace(/\n/g, '<br>');
    }

    // خاتىرىگە قوشۇش فۇنكسىيەسى
    function addToHistory(question, rawAnswer) {
        const row = historyBody.insertRow(0); // يېڭى خاتىرىنى ئۈستىگە قوشىدۇ
        const cell1 = row.insertCell(0);
        const cell2 = row.insertCell(1);

        cell1.textContent = question;
        cell2.textContent = rawAnswer; // خام تېكىستنى ساقلايمىز

        if (historyBody.rows.length > 0) {
            saveHistoryBtn.style.display = 'block'; // جەدۋەلدە خاتىرە بولسا كۇنۇپكىنى كۆرسىتىش
        }
    }

    // خاتىرىنى چۈشۈرۈش فۇنكسىيەسى
    function downloadHistory() {
        let textContent = "Gemini سۆھبەت خاتىرىسى\n===========================\n\n";

        // جەدۋەلنىڭ ئەڭ ئاستىدىكى قۇردىن باشلاپ ئوقۇش (chronological order)
        for (let i = historyBody.rows.length - 1; i >= 0; i--) {
            const row = historyBody.rows[i];
            const question = row.cells[0].textContent;
            const answer = row.cells[1].textContent;

            textContent += `--------------------------------------\n`;
            textContent += `[سۇئال]:\n${question}\n\n`;
            textContent += `[جاۋاب]:\n${answer}\n\n`;
        }

        if (textContent === "") {
            alert("چۈشۈرگۈدەك خاتىرە يوق!");
            return;
        }

        const date = new Date();
        const timestamp = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}_${String(date.getHours()).padStart(2, '0')}-${String(date.getMinutes()).padStart(2, '0')}`;
        const filename = `Gemini_sohbet_khatirisi_${timestamp}.txt`;

        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // --- ئاۋازلىق ئوقۇشقا ئائىت فۇنكسىيەلەر (3-توربەتتىن ئېلىندى) ---

    function speakAnswer() {
        // جاۋاب قۇتىسىدىكى HTML tag لىرىنى ئېلىۋېتىپ، ساپ تېكىستنى ئالىدۇ
        const textToSpeak = answerOutput.innerText;
        const lang = languageSelect.value;
        const rateValue = parseFloat(rateSelect.value);

        if (!textToSpeak || textToSpeak.includes('جاۋابى بۇ يەردە چىقىدۇ')) {
            alert('ئوقۇيدىغان جاۋاب تېخى يوق!');
            return;
        }

        if ('speechSynthesis' in window) {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel(); // ئالدىنقى ئوقۇشنى توختىتىش
            }

            let convertedText = textToSpeak;
            let voiceLang = lang;
            let voiceName = null;

            // تاللانغان تىلغا ئاساسەن تېكىستنى ئايلاندۇرۇش ۋە ئاۋازنى تاللاش
            if (lang.startsWith('ug-UG')) {
                if (lang === 'ug-UG0' || lang === 'ug-UG2') { // تۈركچە ئاھاڭ
                    convertedText = convertUyghurToULYTurk(textToSpeak);
                    voiceLang = 'tr-TR';
                    if (lang === 'ug-UG2') voiceName = 'Ahmet';
                } else { // ئۆزبېكچە ئاھاڭ
                    convertedText = convertUyghurToULY(textToSpeak);
                    voiceLang = 'uz-UZ';
                    if (lang === 'ug-UG') voiceName = 'Madina';
                    else if (lang === 'ug-UG1') voiceName = 'Sardor';
                }
            }

            currentUtterance = new SpeechSynthesisUtterance(convertedText);
            currentUtterance.rate = rateValue;
            currentUtterance.lang = voiceLang;

            // ئاۋازلارنى يۈكلەشنى ساقلاش
            let voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                speechSynthesis.onvoiceschanged = () => {
                    voices = speechSynthesis.getVoices();
                    setVoiceAndSpeak(voices, voiceLang, voiceName);
                };
            } else {
                setVoiceAndSpeak(voices, voiceLang, voiceName);
            }

        } else {
            alert('سىزنىڭ تور كۆرگۈچىڭىز ئاۋازلىق ئوقۇشنى قوللىمايدىكەن. Microsoft Edge دا سىناپ بېقىڭ.');
        }
    }

    function setVoiceAndSpeak(voices, lang, name) {
        let selectedVoice = voices.find(voice => voice.lang === lang && (name ? voice.name.includes(name) : true));
        if (!selectedVoice) {
            selectedVoice = voices.find(voice => voice.lang === lang); // ئىسمى تېپىلمىسا، شۇ تىلدىكى تۇنجى ئاۋازنى ئالىدۇ
        }

        currentUtterance.voice = selectedVoice;
        speechSynthesis.speak(currentUtterance);
    }


    // ئۇيغۇرچىنى ئۆزبېك لاتىنچىسىغا ئايلاندۇرۇش
    function convertUyghurToULY(text) {
        const UY_TO_ULY_MAP = { 'ا': 'a', 'ە': 'e', 'ب': 'b', 'پ': 'p', 'ت': 't', 'ج': 'j', 'چ': 'ch', 'خ': 'x', 'د': 'd', 'ر': 'r', 'ز': 'z', 'ژ': 'zh', 'س': 's', 'ش': 'sh', 'غ': 'gh', 'ف': 'f', 'ق': 'q', 'ك': 'k', 'گ': 'g', 'ڭ': 'ng', 'ل': 'l', 'م': 'm', 'ن': 'n', 'ھ': 'h', 'و': 'o', 'ۇ': 'u', 'ۆ': 'o', 'ۈ': 'u', 'ي': 'y', 'ۋ': 'v', 'ې': 'e', 'ى': 'i', 'ئ': '', '؟': '?' };
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            result += UY_TO_ULY_MAP[char] !== undefined ? UY_TO_ULY_MAP[char] : char;
        }
        return result;
    }

    // ئۇيغۇرچىنى تۈرك لاتىنچىسىغا ئايلاندۇرۇش
    function convertUyghurToULYTurk(text) {
        const UY_TO_ULY_MAPT = { 'ا': 'a', 'ە': 'e', 'ب': 'b', 'پ': 'p', 'ت': 't', 'ج': 'c', 'چ': 'ç', 'خ': 'h', 'د': 'd', 'ر': 'r', 'ز': 'z', 'ژ': 'j', 'س': 's', 'ش': 'ş', 'غ': 'ğ', 'ف': 'f', 'ق': 'k', 'ك': 'k', 'گ': 'g', 'ڭ': 'n', 'ل': 'l', 'م': 'm', 'ن': 'n', 'ھ': 'h', 'و': 'o', 'ۇ': 'u', 'ۆ': 'ö', 'ۈ': 'ü', 'ي': 'y', 'ۋ': 'v', 'ې': 'e', 'ى': 'i', 'ئ': '', '؟': '?' };
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            result += UY_TO_ULY_MAPT[char] !== undefined ? UY_TO_ULY_MAPT[char] : char;
        }
        return result;
    }
</script>

</body>
</html>