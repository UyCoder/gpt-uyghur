<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/UyCoder/paydilar/master/pics/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تېسكىتنى ئاۋازلىق ئاڭلاش</title>

    <style>
        @font-face {
            font-family: 'alkatipTor';
            src: url('ALKATIPTOR.TTF');
        }
        * { direction: rtl; }
        body { background-color: #282c34; color: #fff; font-family: 'alkatipTor' !important; }
        #inputText { background-color: #1e2124; color: #fff; border: none; padding: 10px; width: 100%; box-sizing: border-box; height: 100px; resize: vertical; font-family: 'alkatipTor' !important; }
        #language { background-color: #1e2124; color: #fff; border: none; padding: 10px; width: 100%; box-sizing: border-box; height: 30px; resize: none; direction: ltr !important; }
        #speakBtn { background-color: #009b74; color: #fff; border: none; padding: 10px; cursor: pointer; font-family: 'alkatipTor' !important; }
        #speakBtn:hover { background-color: #444; }
        #stopBtn { background-color: #d9534f; color: #fff; border: none; padding: 10px; cursor: pointer; font-family: 'alkatipTor' !important; }
        #stopBtn:hover { background-color: #c9302c; }
        #downloadBtn { background-color: #5bc0de; color: #fff; border: none; padding: 10px; cursor: pointer; font-family: 'alkatipTor' !important; }
        #downloadBtn:hover { background-color: #31b0d5; }
        #telegramBtn { background-color: #0088cc; color: #fff; border: none; padding: 10px; cursor: pointer; font-family: 'alkatipTor' !important; }
        #telegramBtn:hover { background-color: #006fa3; }
        h1 { color: #009b74; font-size: xx-large; text-align: center; }
        label { color: #b6b5b5; font-size: small; padding: 20px; font-style: italic; }
        select { color: #fff; }
        .navbar { overflow: hidden; background-color: #333; position: fixed; top: 0; width: 100%; display: flex; justify-content: center; }
        .navbar a { float: left; display: block; color: white; text-align: center; padding: 14px 16px; text-decoration: none; }
        .navbar a:hover { background-color: #ddd; color: black; }
    </style>
</head>
<body>
<div class="navbar" >
    <a href="IsilTerjiman.html"> تەرجىمان</a>
    <a href="HikmetlerHezinesi.html" >ھىكمەت</a>
    <a href="TextToSpeachUy.html"> ئاڭلاش</a>
    <a href="../index.html">Gemini</a>
    <a href="wordcounter.html"> تېكىست </a>
    <a href="wordreplacer.html"> ئىملا </a>
    <a href="teshkil.html">تەشكىل</a>
    <a href="https://www.yulghun.com/tools/"> يۇلغۇن </a>
    <a href="https://translate.google.com.tr/?sl=auto&tl=ug&text=I%20can%20translate%20uyghur%20language%20to%20english&op=translate" target="_blank"> Google </a>
</div>

<h1 id="b"> .</h1>
<h1 id="b">تېكىستنى ئاۋازلىق ئاڭلاش قۇرالى </h1>
<p style="font-size: small;  color: white ; text-align: center " id="random-sentence"></p>
<a style="color: white ; font-size: small; background-color:#009b74 ">ئەسكەرتىش: ھازىرچە پەقەتلا Edge توركۆرگۈچتە نورمال ئوقۇپ ېېرەلەيدۇ!!!</a>
<br><br>
<script>
    fetch('https://raw.githubusercontent.com/UyCoder/paydilar/master/hikmetler/hikmetler.txt')
        .then(response => response.text())
        .then(text => {
            const sentences = text.split('. ');
            const randomIndex = Math.floor(Math.random() * sentences.length);
            document.getElementById('random-sentence').textContent = "« " + sentences[randomIndex] + " »";
        });
</script>

<textarea id="inputText" style="resize: vertical"  rows="50" cols="50" placeholder="ئاڭلىماقچى  بولغان تېكىستنى بۇ يەرگە چاپلاڭ..."></textarea><br>

<label style=" font-family: 'alkatipTor'; font-style: normal; color: white" for="language">تېسكىتنىڭ ئاۋازىنى تاللاڭ:</label>
<select style=" background-color: white ; color: black ;font-family: 'alkatipTor' ; height: 40px; width: auto" id="language">
    <option value="ug-UG0">ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG1">1ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG2">2ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG3">3ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG4">4ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG5">5ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG6">6ئۇيغۇرچە (ئەر)</option>
    <option value="ug-UG">ئۇيغۇرچە - (ئايال)</option>
    <option value="en-US">ئارىلاشما تىللار</option>
    <option value="ar-SA">ئەرەبچە</option>
    <option value="tr-TR">تۈركچە</option>
    <option value="zh-CN">خىتايچە</option>
</select><br>

<label style=" font-family: 'alkatipTor'; font-style: normal; color: white" for="rate">ئوقۇش سۈرئىتىنى تاللاڭ</label>
<select style=" background-color: white ; color: black ; height: 40px; width: auto" id="rate" name="rate">
    <option value="1.0">1x</option>
    <option value="1.25">1.25x</option>
    <option value="1.5">1.5x</option>
    <option value="2.0">2x</option>
    <option value="0.5">0.5x</option>
    <option value="0.75">0.75x</option>
</select>

<button id="speakBtn">ئاۋازلىق ئوقۇ</button>
<button id="stopBtn">توختات</button>
<button id="downloadBtn">ئاۋازنى چۈشۈرۈش</button>
<button id="telegramBtn">تېلېگرام</button>

<div id="telegramSection" style="display: none; margin-top: 15px;">
    <input type="text" id="botApiInput" placeholder="بوت ئېيپىئاي كىرگۈزۈڭ" style="background-color: #1e2124; color: #fff; border: 1px solid #009b74; padding: 10px; box-sizing: border-box; font-family: 'alkatipTor' !important; margin-left: 5px;">
    <input type="text" id="channelIdInput" placeholder="قانال ئايدى(@channel) كىرگۈزۈڭ" style="background-color: #1e2124; color: #fff; border: 1px solid #009b74; padding: 10px; box-sizing: border-box; font-family: 'alkatipTor' !important; margin-left: 5px;">
    <button id="sendToTelegramBtn" style="background-color: #0088cc; color: #fff; border: none; padding: 10px; cursor: pointer; font-family: 'alkatipTor' !important;">تېلېگرامغا يوللاڭ</button>
</div>


<br><a style="color: #009b74 ; font-size: small">ئەسكەرتىش: ئۇيغۇرچە ئوقۇتقاندا دەسلەپتە كۇنۇپكىنى ئىككى قېتىم بېسىڭ.</a>

<br><br><br><br><br><br><br><br><br>
<footer>
    <ab id="a" style="font-style: italic; font-size: small; color: #b6b5b5">بۇ كىچىك تەرجىمە قورالى مېنىڭ شەخسىي قىزىقىشىم بىلەنلا يېزىپ چىقىلدى. ئەسلىدە ئۇيغۇرچە ئوقۇش مۇلازىمىتى ھازىرچە يوق. ئەمما مەن ئارقا سۇپىدا ئۆزبېكچە ۋە تۈركچە يېزىققا ئايلاندۇرۇپ ئاندىن ئۇنى ئاۋازلىق ئوقۇتتۇم. ئاۋاز ئۈنۈمى كەسپىي ئەمەس. ئەمما تامامەن ئاڭلاپ چۈشىنىشكە بولىدۇ.</ab>
    <br><br>
    <ba id="contact">مېنى بۇ يەردىن ئىزدەڭ</ba>
    <a href="https://uycoder.github.io/paydilar/"><img src="https://raw.githubusercontent.com/UyCoder/paydilar/master/pics/favicon.png" height="25"></a>
    <a href="https://www.linkedin.com/in/ahmed-bughra/"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/LinkedIn.svg" alt="linkedin" height="25"></a>
    <a href="https://github.com/Uycoder"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/github.svg" alt="github" height="25"></a>
    <a href="https://www.hackerrank.com/ahmedbughra"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/hackerrank.svg" alt="hackerrank" height="25"></a>
    <a href="https://stackoverflow.com/users/16111723/ahmad-ali"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/Stack_Overflow.svg" alt="stackoverflow" height="25"></a>
</footer>

<script>
    const inputText = document.getElementById('inputText');
    const language = document.getElementById('language');
    const rateSpeed = document.getElementById('rate');
    const speakBtn = document.getElementById('speakBtn');
    const stopBtn = document.getElementById('stopBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    // --- يېڭىدىن قوشۇلغان تېلېگرام ئېلېمېنتلىرى ---
    const telegramBtn = document.getElementById('telegramBtn');
    const telegramSection = document.getElementById('telegramSection');
    const botApiInput = document.getElementById('botApiInput');
    const channelIdInput = document.getElementById('channelIdInput');
    const sendToTelegramBtn = document.getElementById('sendToTelegramBtn');


    let currentUtterance = null;
    let mediaRecorder = null;
    let audioChunks = [];

    const UY_TO_ULY_MAP = {'ا':'a','ە':'e','ب':'b','پ':'p','ت':'t','ج':'j','چ':'ch','خ':'x','د':'d','ر':'r','ز':'z','ژ':'zh','س':'s','ش':'sh','غ':'gh','ف':'f','ق':'q','ك':'k','گ':'g','ڭ':'ng','ل':'l','م':'m','ن':'n','ھ':'h','و':'o','ۇ':'u','ۆ':'o','ۈ':'u','ي':'y','ۋ':'v','ې':'e','ى':'i','ئ':'','؟':'?'};
    const UY_TO_ULY_MAPT = {'ا':'a','ە':'e','ب':'b','پ':'p','ت':'t','ج':'c','چ':'ç','خ':'hh','د':'d','ر':'r','ز':'z','ژ':'j','س':'s','ش':'ş','غ':'gh','ف':'f','ق':'k','ك':'k','گ':'g','ڭ':'n','ل':'l','م':'m','ن':'n','ھ':'h','و':'o','ۇ':'u','ۆ':'ö','ۈ':'ü','ي':'y','ۋ':'v','ې':'e','ى':'i','ئ':'','؟':'?'};

    function convertUyghurToULY(text) {
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            result += UY_TO_ULY_MAP[char] || char;
        }
        return result;
    }

    function convertUyghurToULYTurk(text) {
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            result += UY_TO_ULY_MAPT[char] || char;
        }
        return result;
    }

    // ئاۋاز جۈملىسى ھاسىل قىلىدىغان ياردەمچى فۇنكسىيە
    function createUtterance() {
        const text = inputText.value;
        const lang = language.value;
        if (!text.trim()) return null;

        let convertedText = text;
        if (lang.startsWith('ug-UG')) {
            const converter = (lang === 'ug-UG' || lang === 'ug-UG1') ? convertUyghurToULY : convertUyghurToULYTurk;
            convertedText = converter(text);
        }

        const utterance = new SpeechSynthesisUtterance(convertedText);
        utterance.lang = lang;
        utterance.rate = parseFloat(rateSpeed.value);

        const voices = speechSynthesis.getVoices();
        const voiceMap = {
            'ug-UG': v => v.lang === 'uz-UZ' && v.name.includes('Madina'),
            'ug-UG0': v => v.lang === 'tr-TR',
            'ug-UG1': v => v.lang === 'uz-UZ' && v.name.includes('Sardor'),
            'ug-UG2': v => v.lang === 'tr-TR' && v.name.includes('Ahmet'),
            'ug-UG3': v => v.lang === 'en-US' && v.name.includes('Andrew'),
            'ug-UG4': v => v.lang === 'fr-FR' && v.name.includes('Remy'),
            'ug-UG5': v => v.lang === 'en-US' && v.name.includes('Brian'),
            'ug-UG6': v => v.lang === 'de-DE' && v.name.includes('Florian'),
            'en-US': v => v.lang === 'en-US' && v.name.includes('Brian'),
            'ar-SA': v => v.lang === 'ar-SA' && v.name.includes('Hamed'),
        };
        utterance.voice = voices.find(voiceMap[lang] || (v => v.lang === lang && v.gender === 'male'));
        return utterance;
    }

    // ئاۋازلىق ئوقۇش
    function speakText() {
        if (speechSynthesis.speaking) {
            speechSynthesis.cancel();
        }
        currentUtterance = createUtterance();
        if (currentUtterance) {
            speechSynthesis.speak(currentUtterance);
        } else {
            alert('سىز تېخى بىرەر تېكىست كىرگۈزمىدىڭىز!');
        }
    }

    // توختىتىش
    function stopText() {
        speechSynthesis.cancel();
    }

    // ئاۋازنى چۈشۈرۈش
    async function downloadAudio() {
        if (!inputText.value.trim()) {
            alert('چۈشۈرۈشتىن بۇرۇن بىرەر تېكىست كىرگۈزۈڭ!');
            return;
        }
        if (!('MediaRecorder' in window)) {
            alert('كەچۈرۈڭ، تور كۆرگۈچىڭىز ئاۋاز خاتىرىلەشنى قوللىمايدىكەن.');
            return;
        }

        alert('ئاۋازلىق ھۆججەت ھاسىل قىلىش ئۈچۈن، كېيىنكى كۆزنەكتە «بۇ بەتنىڭ ئاۋازىنى ھەمبەھىرلەش» (Share tab audio) نى تاللاڭ.');

        try {
            const displayStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
            const audioStream = new MediaStream(displayStream.getAudioTracks());
            mediaRecorder = new MediaRecorder(audioStream, { mimeType: 'audio/webm' });
            audioChunks = [];

            mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
            
            mediaRecorder.onstop = () => {
                displayStream.getTracks().forEach(track => track.stop());
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const downloadUrl = URL.createObjectURL(audioBlob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = downloadUrl;
                a.download = 'paydilar_audio.webm';
                document.body.appendChild(a);
                a.click();
                URL.revokeObjectURL(downloadUrl);
                a.remove();
            };

            const utteranceForDownload = createUtterance();
            if (!utteranceForDownload) return;

            utteranceForDownload.onend = () => {
                setTimeout(() => {
                    if (mediaRecorder && mediaRecorder.state === "recording") {
                        mediaRecorder.stop();
                    }
                }, 500);
            };

            mediaRecorder.start();
            speechSynthesis.speak(utteranceForDownload);

        } catch (error) {
            console.error("ئاۋاز خاتىرىلەشتە خاتالىق:", error);
            alert("ئاۋاز خاتىرىلەش مەغلۇپ بولدى. سىز بەلكىم ھەمبەھىرلەش تەلىپىنى رەت قىلغان ياكى تور بېكەتنى http://localhost ئادرېسىدىن ئاچمىغان بولۇشىڭىز مۇمكىن.");
        }
    }
    
    // --- يېڭىدىن قوشۇلغان تېلېگرام فۇنكىسىيەسى ---
    function sendToTelegram() {
        const botApi = botApiInput.value.trim();
        const channelId = channelIdInput.value.trim();
        const text = inputText.value.trim();

        if (!botApi || !channelId || !text) {
            alert('بوت ئېيپىئاي، قانال ئايدى ۋە يوللىنىدىغان تېكىست مەزمۇنىنى تولدۇرۇڭ!');
            return;
        }

        const url = `https://api.telegram.org/bot${botApi}/sendMessage`;
        const params = {
            chat_id: channelId,
            text: text,
            parse_mode: 'Markdown' // خالىسا بۇنى ئىشلەتسىڭىز بولىدۇ
        };

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(params)
        })
        .then(response => response.json())
        .then(data => {
            if (data.ok) {
                alert('تېكىست تېلېگرامغا مۇۋەپپەقىيەتلىك يوللاندى!');
            } else {
                alert(`يوللاش مەغلۇپ بولدى: ${data.description}`);
            }
        })
        .catch(error => {
            console.error('تېلېگرامغا يوللاشتا خاتالىق:', error);
            alert('تېلېگرامغا يوللاشتا خاتالىق كۆرۈلدى. كونترول سۇپىسىنى(console) تەكشۈرۈڭ.');
        });
    }


    speakBtn.addEventListener('click', speakText);
    stopBtn.addEventListener('click', stopText);
    downloadBtn.addEventListener('click', downloadAudio);
    
    // --- يېڭىدىن قوشۇلغان تېلېگرام كۇنۇپكا ئاڭلىغۇچلىرى ---
    telegramBtn.addEventListener('click', () => {
        // تېلېگرام بۆلىكىنى كۆرسىتىش/يوشۇرۇش
        telegramSection.style.display = telegramSection.style.display === 'none' ? 'block' : 'none';
    });
    
    sendToTelegramBtn.addEventListener('click', sendToTelegram);


    // Ensure voices are loaded before any action
    speechSynthesis.onvoiceschanged = () => {
        const voices = speechSynthesis.getVoices();
        console.log("ئاۋازلار يۈكلەندى:", voices);
    };
</script>

</body>
</html>