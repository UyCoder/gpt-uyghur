<!DOCTYPE html>
<html lang="ug">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/UyCoder/paydilar/master/pics/favicon.png">
    <title>ھىكمەتلەر خەزىنىسى</title>
    <style>
        /* --- Font Definitions --- */
        @font-face { font-family: 'QuranQalam'; src: url('https://cdn.jsdelivr.net/gh/fawazahmed0/quran-api@1/fonts/al-qalam-quran-majeed-1.woff'); }
        @font-face { font-family: 'AlkatipTor'; src: url('https://raw.githubusercontent.com/UyCoder/gpt-uyghur/master/useGoogleTranslate/ALKATIPTOR.TTF'); }
        @font-face { font-family: 'Hafs-Uthmanic'; src: url('https://cdn.jsdelivr.net/gh/fawazahmed0/quran-api@1/fonts/hafs-uthmanic-v14-full.woff'); }

        /* --- General Styles --- */
        :root {
            --background-color: #282c34;
            --container-bg: rgba(49, 53, 63, 0.7);
            --text-color: #f5f5f5;
            --primary-color: #20c997;
            --primary-hover: #1baa80;
            --metadata-color: #a0a0a0;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --border-color: rgba(255, 255, 255, 0.1);
            --uyghur-translation-color: #e6db74;
            --analysis-bg-color: rgba(0, 0, 0, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; direction: rtl; }
	
        body {
            font-family: 'AlkatipTor', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex; flex-direction: column; min-height: 100vh;
        }

        .navbar {
            overflow: hidden; background-color: #333; width: 100%; display: flex;
            justify-content: center; flex-wrap: wrap; position: fixed; top: 0; z-index: 1000;
        }
        .navbar a {
            float: right; display: block; color: white; text-align: center;
            padding: 14px 16px; text-decoration: none; transition: background-color 0.3s, color 0.3s;
        }
        .navbar a:hover { background-color: var(--primary-color); color: white; }
        
        main {
            padding-top: 80px; flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start; padding-bottom: 50px;
        }
        h1 { text-align: center; color: var(--text-color); margin-bottom: 20px; text-shadow: 2px 2px 4px var(--shadow-color); }
        .container {
            max-width: 700px; width: 90%; margin: 10px auto; padding: 30px; background: var(--container-bg);
            box-shadow: 0 8px 32px 0 var(--shadow-color); backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px); border-radius: 15px; border: 1px solid var(--border-color); text-align: center;
        }
        .controls { display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap; }
        
        select {
            font-family: 'AlkatipTor'; text-align: center; height: 42px; padding: 0 15px; border: 1px solid var(--border-color);
            border-radius: 8px; background-color: rgba(255, 255, 255, 0.1); color: var(--text-color); font-size: 16px;
        }
        select option { color: #000000; background-color: #FFFFFF; }

        button {
            padding: 10px 20px; background-color: var(--primary-color); color: #fff; border: none; border-radius: 8px;
            cursor: pointer; transition: all 0.3s ease-in-out; font-family: 'AlkatipTor'; font-size: 16px;
            display: flex; align-items: center; gap: 8px;
        }
        button:hover { background-color: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        #apiKeySection {
            display: none; /* Hide by default */
            font-size: 14px;
            color: var(--metadata-color);
        }
        #apiKeySection input {
            padding: 5px; border-radius: 5px; border: 1px solid var(--border-color);
            background-color: rgba(255, 255, 255, 0.1); color: var(--text-color);
            margin: 0 5px; width: 250px; direction: ltr;
        }

        hr { border: none; height: 1px; background-color: rgba(255, 255, 255, 0.15); margin: 25px 0; }

        .result {
            margin-top: 30px; min-height: 200px; font-size: 22px; text-align: right;
            color: var(--text-color); line-height: 1.8; font-family: 'AlkatipTor';
        }
        .result-section {
            background-color: var(--analysis-bg-color);
            border-right: 3px solid var(--primary-color);
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            text-align: right;
        }
        .result-section h3 {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .result-section ul {
             list-style-type: none; padding-right: 20px; 
        }
        .result-section li {
             margin-bottom: 8px; 
        }
        
        .result .arabic-text { font-family: 'QuranQalam', 'Hafs-Uthmanic', sans-serif !important; font-size: 2.5rem; line-height: 1.7; text-align: center;}
        .result .hadith-arabic { font-family: 'Hafs-Uthmanic', sans-serif !important; font-size: 2.2rem; line-height: 1.8; text-align: center;}
        .result .english-text { font-size: 20px; font-style: italic; color: #dcdcdc; direction: ltr; text-align: left; }
        .result .author { font-size: 16px; direction: ltr; text-align: left; color: var(--metadata-color);}
        .result .uyghur-translation { font-size: 20px; color: var(--uyghur-translation-color); }
        .result .metadata, .result .fallback-note { font-size: 13px; color: var(--metadata-color); font-style: italic; margin-top: 20px; text-align: center; }

        footer {
            width: 100%; padding: 20px; text-align: center; background-color: #333;
            color: var(--metadata-color); font-style: italic; font-size: 14px;
        }
        footer .social-links { margin-top: 10px; }
        footer a { margin: 0 8px; }
        footer img { height: 25px; opacity: 0.7; transition: opacity 0.3s; }
        footer img:hover { opacity: 1; }
    </style>
</head>

<body>

    <div class="navbar">
        <a href="IsilTerjiman.html">تەرجىمان</a><a href="HikmetlerHezinesi.html">ھىكمەت</a><a href="TextToSpeachUy.html">ئاڭلاش</a><a href="../index.html">Gemini</a>
        <a href="wordcounter.html">تېكىست</a><a href="wordreplacer.html">ئىملا</a><a href="teshkil.html">تەشكىل</a><a href="https://www.yulghun.com/tools/" target="_blank">يۇلغۇن</a>
        <a href="https://translate.google.com.tr/?sl=auto&tl=ug&text=Uyghur" target="_blank">Google</a>
    </div>

    <main>
        <h1>ھىكمەتلەر خەزىنىسى</h1>
        <div class="container" id="apiKeySection">
             <label for="apiKeyInput">Gemini API ئاچقۇچى:</label>
             <input type="password" id="apiKeyInput" placeholder="ئۆزىڭىزنىڭ API ئاچقۇچىنى كىرگۈزۈڭ">
             <button id="saveApiKeyBtn" style="padding: 5px 10px; font-size: 14px;">ساقلاش</button>
             <p style="font-size: 12px; margin-top: 5px;">(بوش قالدۇرسىڭىز سۈكۈتتىكى ئاچقۇچ ئىشلىتىلىدۇ. <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--primary-color);">بۇ يەردىن</a> ھەقسىز ئاچقۇچ ئالالايسىز)</p>
        </div>
        
        <div class="container">
            <div class="controls">
                <select id="select-type">
                    <option value="quran">قۇرئان كەرىمدىن بىر ئايەت</option>
                    <option value="hadith">سەھىھ ھەدىس (Gemini تەھلىلى)</option>
                    <option value="uyghur-language-sayings">ئۇيغۇرچە پايدىلىق سۆزلەر</option>
                    <option value="english-famous-sayings">ئىنگلىزچە ھېكمەت (Gemini تەھلىلى)</option>
                </select>
                <button id="get-saying-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.1.7a.5.5 0 0 1 .4-.2h9a.5.5 0 0 1 .4.2l2.976 3.974c.149.199.224.458.224.716v1.134a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5V5.39c0-.258.075-.517.224-.716zm11.386 3.785-1.806-2.41-.776 2.413a.5.5 0 0 1-.444.25h-3.493a.5.5 0 0 1-.444-.25l-.776-2.413-1.806 2.41L1 4.636 1.928 3.5H14.072L15 4.636zM1.938 6.11l.528.695c.149.198.223.457.223.715v4.545a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5V7.52c0-.258.075-.517.223-.715zM14.062 6.11l.528.695c.149.198.223.457.223.715v4.545a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5V7.52c0-.258.075-.517.223-.715zm-2.94-1.11h-1.815a.5.5 0 0 1-.444-.25L8 2.5 6.224 4.75a.5.5 0 0 1-.444.25H3.97c-.287 0-.462.332-.294.55l1.64 2.187c.148.197.222.457.222.715v4.546a.5.5 0 0 1-.5.5h5a.5.5 0 0 1-.5-.5V8.169c0-.258.075-.518.222-.715l1.64-2.187c.168-.218-.007-.55-.294-.55z"/></svg>
                    خەزىنىدىن بىر چاڭگال
                </button>
            </div>
            <div class="result"><p>يۇقىرىدىكى تۈرلەردىن بىرىنى تاللاپ، «خەزىنىدىن بىر چاڭگال» توپچىسىنى بېسىڭ.</p></div>
        </div>
    </main>

    <footer>
        مېنى بۇ يەردىن ئىزدەڭ
        <div class="social-links">
            <a href="https://uycoder.github.io/paydilar/" target="_blank"><img src="https://raw.githubusercontent.com/UyCoder/paydilar/master/pics/favicon.png" alt="Paydilar Website"></a>
            <a href="https://www.linkedin.com/in/ahmed-bughra/" target="_blank"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/LinkedIn.svg" alt="linkedin"></a>
            <a href="https://github.com/Uycoder" target="_blank"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/github.svg" alt="github"></a>
            <a href="https://www.hackerrank.com/ahmedbughra" target="_blank"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/hackerrank.svg" alt="hackerrank"></a>
            <a href="https://stackoverflow.com/users/16111723/ahmad-ali" target="_blank"><img src="https://raw.githubusercontent.com/UyCoder/gpt-uyghur/a0f5cf2daf86aa371a15086a6214a2444be1ff92/pics/Stack_Overflow.svg" alt="stackoverflow"></a>
        </div>
    </footer>


<script>
    // --- DOM Elements ---
    const selectType = document.getElementById('select-type');
    const getSayingBtn = document.getElementById('get-saying-btn');
    const result = document.querySelector('.result');
    const apiKeySection = document.getElementById('apiKeySection');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');

    // --- API Keys & Config ---
    let geminiApiKey = localStorage.getItem('geminiApiKey') || '';
    const DEFAULT_API_KEY = 'AIzaSyCkpkBDY_HmxOQIwEmILG6M-9t2ek6kObU'; // Fallback key
    apiKeyInput.value = geminiApiKey;
    
    // --- Verse Data ---
    const versesInSurah = {1:7,2:286,3:200,4:176,5:120,6:165,7:206,8:75,9:129,10:109,11:123,12:111,13:43,14:52,15:99,16:128,17:111,18:110,19:98,20:135,21:112,22:78,23:118,24:64,25:77,26:227,27:93,28:88,29:69,30:60,31:34,32:30,33:73,34:54,35:45,36:83,37:182,38:88,39:75,40:85,41:54,42:53,43:89,44:59,45:37,46:35,47:38,48:29,49:18,50:45,51:60,52:49,53:62,54:55,55:78,56:96,57:29,58:22,59:24,60:13,61:14,62:11,63:11,64:18,65:12,66:12,67:30,68:52,69:52,70:44,71:28,72:28,73:20,74:56,75:40,76:31,77:50,78:40,79:46,80:42,81:29,82:19,83:36,84:25,85:22,86:17,87:19,88:26,89:30,90:20,91:15,92:21,93:11,94:8,95:8,96:19,97:5,98:8,99:8,100:11,101:11,102:8,103:3,104:9,105:5,106:4,107:7,108:3,109:6,110:3,111:5,112:4,113:5,114:6};

    // --- Event Listeners ---
    const toggleApiKeySection = () => {
        const selectedValue = selectType.value;
        apiKeySection.style.display = (selectedValue === 'hadith' || selectedValue === 'english-famous-sayings') ? 'block' : 'none';
    };

    document.addEventListener('DOMContentLoaded', toggleApiKeySection);
    selectType.addEventListener('change', toggleApiKeySection);

    saveApiKeyBtn.addEventListener('click', () => {
        geminiApiKey = apiKeyInput.value.trim();
        localStorage.setItem('geminiApiKey', geminiApiKey);
        alert('API ئاچقۇچى ساقلاندى!');
    });

    getSayingBtn.addEventListener('click', () => {
        const selectedType = selectType.value;
        result.innerHTML = `<p>يۈكلىنىۋاتىدۇ...</p>`;
        const functionMap = {'quran':fetchQuran, 'hadith':fetchHadithAndAnalyze, 'uyghur-language-sayings':fetchUyghurSaying, 'english-famous-sayings':fetchQuoteAndAnalyze};
        if(functionMap[selectedType]) functionMap[selectedType]();
    });

    // --- Utility Functions ---
    function showErrorMsg() { result.innerHTML = 'كەچۈرۈڭ، مەنبەدىن ئۇچۇر ئېلىشتا خاتالىق كۆرۈلدى. API ئاچقۇچىنىڭ توغرىلىقىنى ياكى تورنى تەكشۈرۈپ قايتا سىناڭ.';}
    
    async function callGemini(prompt) {
        const activeApiKey = geminiApiKey || DEFAULT_API_KEY;
        if (!activeApiKey) {
            showErrorMsg();
            return null;
        }
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${activeApiKey}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            if (!response.ok) throw new Error(`API error: ${response.status}`);
            const data = await response.json();
            const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;
            return text ? text.replace(/<br>/g, '') : null;
        } catch (error) { console.error("Gemini API Error:", error); return null; }
    }

    // --- Core Fetching & Analysis Logic ---
    async function fetchQuran() {
        try {
            const randTotal = Math.floor(Math.random() * 6236) + 1;
            let surah = 1, aya = randTotal;
            while (aya > versesInSurah[surah]) { aya -= versesInSurah[surah]; surah++; }
            const response = await fetch(`https://quranenc.com/api/v1/translation/aya/uyghur_saleh/${surah}/${aya}`);
            const data = await response.json();
            result.innerHTML = `<p class="arabic-text">${data.result.arabic_text}</p><p class="uyghur-translation" style="text-align: center;">${data.result.translation}</p><p class="metadata">سۈرە ${data.result.sura} ، ${data.result.aya}-ئايەت</p>`;
        } catch (error) { console.error("Quran fetch error:", error); showErrorMsg(); }
    }

    async function fetchHadithAndAnalyze() {
        try {
            const hadithPage = Math.floor(Math.random() * 1630) + 1;
            const response = await fetch(`https://www.hadithapi.com/api/hadiths?page=${hadithPage}&apiKey=$2y$10$P8qg7sxBl36IwM4QdhiWgeTtxCfaySm7Hsy3qS2UECsNXESYDBOW`);
            const data = await response.json();
            if (!data.hadiths.data || data.hadiths.data.length === 0) { fetchHadithAndAnalyze(); return; }
            const hadith = data.hadiths.data[Math.floor(Math.random() * data.hadiths.data.length)];
            
            result.innerHTML = `<p class="hadith-arabic">${hadith.hadithArabic}</p><hr><p>Gemini تەرىپىدىن تەرجىمە ۋە تەھلىل قىلىنىۋاتىدۇ...</p>`;
            
            const translationPrompt = `تۆۋەندىكى ئەرەبچە ھەدىسنى راۋان ۋە تەبىئىي ئۇيغۇرچىغا (ئەرەب يېزىقى) تەرجىمە قىل. پەقەت تەرجىمىنىلا قايتۇر، ھېچقانداق قوشۇمچە ئىزاھات بەرمە.\n\nئەرەبچە: "${hadith.hadithArabic}"`;
            const uyghurTranslation = await callGemini(translationPrompt);
            if (!uyghurTranslation) { result.innerHTML = `<p>تەرجىمە قىلىش مەغلۇپ بولدى. API ئاچقۇچىنى تەكشۈرۈڭ.</p>`; return; }

            let finalHtml = `<p class="hadith-arabic">${hadith.hadithArabic}</p><hr><div class="result-section"><h3>Gemini تەرجىمىسى</h3><p class="uyghur-translation">${uyghurTranslation}</p></div>`;
            result.innerHTML = finalHtml + `<p>ساۋاقلار تەھلىل قىلىنىۋاتىدۇ...</p>`;
            
            const lessonPrompt = `بۇ ھەدىسنىڭ ئەرەبچىسى: "${hadith.hadithArabic}" ۋە ئۇيغۇرچە تەرجىمىسى: "${uyghurTranslation}" گە ئاساسەن، بۇ ھەدىستىن ئالغىلى بولىدىغان ئاساسلىق ساۋاقنى ئۇيغۇرچە شەرھلەپ بېرىڭ. پۈتۈن چۈشەندۈرۈش چوقۇم ئۇيغۇرچە (ئەرەب يېزىقى) بولسۇن.`;
            const lesson = await callGemini(lessonPrompt);
            if (lesson) finalHtml += `<div class="result-section"><h3>بۇ ھەدىستىن ئالىدىغان ساۋاق</h3><p>${lesson}</p></div>`;
            result.innerHTML = finalHtml + `<p>ئاچقۇچلۇق سۆزلەر ئانالىز قىلىنىۋاتىدụ...</p>`;

            const vocabPrompt = `بۇ ئەرەبچە ھەدىس تېكىستىدىن: "${hadith.hadithArabic}" 2-3 دانە مۇھىم سۆزنى تېپىپ، ئۇلارنىڭ ئۇيغۇرچە مەنىسىنى ۋە شۇ ھەدىس ئىچىدىكى مەزمۇنىنى چۈشەندۈرۈڭ. بارلىق چۈشەندۈرۈشلەر چوقۇم ئۇيغۇرچە بولسۇن.`;
            const vocab = await callGemini(vocabPrompt);
            if (vocab) finalHtml += `<div class="result-section"><h3>مۇھىم ئاتالغۇلار</h3>${vocab.replace(/\n/g, '<br>')}</div>`;

            result.innerHTML = finalHtml;
        } catch (error) { console.error("Hadith fetch/analyze error:", error); showErrorMsg(); }
    }
    
    async function fetchQuoteAndAnalyze() {
        try {
            const response = await fetch('https://dummyjson.com/quotes/random');
            const data = await response.json();

            result.innerHTML = `<div dir="ltr"><p class="english-text">"${data.quote}"</p><p class="author">- ${data.author}</p></div><hr><p>Gemini تەرىپىدىن تەرجىمە ۋە تەھلىل قىلىنىۋاتىدۇ...</p>`;
            
            const translationPrompt = `Translate the following English text to Uyghur (using Arabic script). Be accurate. Provide only the translation, no extra text.\n\nEnglish: "${data.quote}"`;
            const uyghurTranslation = await callGemini(translationPrompt);
            if (!uyghurTranslation) { result.innerHTML = `<p>تەرجىمە قىلىش مەغلۇپ بولدى. API ئاچقۇچىنى تەكشۈرۈڭ.</p>`; return; }

            let finalHtml = `<div dir="ltr"><p class="english-text">"${data.quote}"</p><p class="author">- ${data.author}</p></div><hr><div class="result-section"><h3>Gemini تەرجىمىسى</h3><p class="uyghur-translation">${uyghurTranslation}</p></div>`;
            result.innerHTML = finalHtml + `<p>ئۆگىنىش نۇقتىلىرى تەييارلىنىۋاتىدۇ...</p>`;
            
            // This is the updated and more specific prompt for English Learning Points
            const analysisPrompt = `
You are an English teacher for a Uyghur student. Your task is to analyze the following English quote and provide "English Learning Points" based on it.
The English quote is: "${data.quote}"
Your response MUST be entirely in Uyghur (using Arabic script).
Follow this structure exactly:
1.  **مۇھىم سۆزلۈكلەر (Key Vocabulary):** List 1-2 important English words from the quote. For each word, provide its English form, its part of speech (e.g., noun, verb), and its meaning in Uyghur.
2.  **گرامماتىكىلىق قۇرۇلما (Grammatical Structure):** Identify one interesting grammatical point or structure in the quote. Explain this point clearly in Uyghur.
Example:
If the quote is "The only way to do great work is to love what you do.", your output should be in Uyghur like this:
***
### ئىنگلىزچە ئۆگىنىش نۇقتىلىرى

**1. مۇھىم سۆزلۈكلەر:**
*   **Great (adj.):** بۈيۈك، ئۇلۇغ، ئېسىل. بۇ يەردە "great work" دېگىنى «ئېسىل خىزمەت» ياكى «ئۇلۇغ ئىش» دېگەن مەنىدە.
*   **Love (v.):** ياخشى كۆرۈش، سۆيۈش. بۇ يەردە «ئىش-ئوقىتىنى قىزغىن سۆيۈش» نى كۆرسىتىدۇ.

**2. گرامماتىكىلىق قۇرۇلما:**
*   **"The only way to..." قۇرۇلمىسى:** بۇ قۇرۇلما «... نىڭ بىردىنبىر يولى» دېگەنلىك بولۇپ، بىر ئىشنى قىلىشنىڭ ئەڭ مۇھىم ياكى يېگانە ئۇسۇلىنى تەكىتلەيدۇ. مەسىلەن، "The only way to succeed is to work hard." (مۇۋەپپەقىيەت قازىنىشنىڭ بىردىنبىر يولى تىرىشىپ ئىشلەش).
***
Now, create the learning points for the provided quote following the rules above. The entire response must be in Uyghur.`;
            
            const analysis = await callGemini(analysisPrompt);
            if(analysis) finalHtml += `<div class="result-section"><h3>ئىنگلىزچە ئۆگىنىش نۇقتىلىرى</h3>${analysis.replace(/\n/g, '<br>')}</div>`;
            
            result.innerHTML = finalHtml;
        } catch (error) { console.error("Quote fetch error:", error); showErrorMsg(); }
    }

    async function fetchUyghurSaying() {
        try {
            const response = await fetch('https://raw.githubusercontent.com/UyCoder/paydilar/master/hikmetler/hikmetler.txt');
            const text = await response.text();
            const sentences = text.split('\n').filter(s => s.trim() !== '');
            result.innerHTML = `<p style="font-size: 24px; text-align: center;">«${sentences[Math.floor(Math.random() * sentences.length)]}»</p>`;
        } catch(error) { console.error("Uyghur saying fetch error:", error); showErrorMsg(); }
    }

</script>



</body>
</html>